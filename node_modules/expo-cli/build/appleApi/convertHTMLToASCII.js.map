{"version":3,"file":"convertHTMLToASCII.js","names":["turndownServices","getService","rootUrl","turndownService","TurndownService","addRule","filter","replacement","content","chalk","strikethrough","bold","italic","node","options","linkStyle","nodeName","getAttribute","href","startsWith","terminalLink","isSupported","cyan","underline","convertHTMLToASCII","service","wrapAnsi","turndown","process","stdout","columns"],"sources":["../../src/appleApi/convertHTMLToASCII.ts"],"sourcesContent":["import chalk from 'chalk';\nimport terminalLink from 'terminal-link';\n// @ts-ignore\nimport TurndownService from 'turndown';\nimport wrapAnsi from 'wrap-ansi';\n\nconst turndownServices: Record<string, any> = {};\n\nfunction getService(rootUrl: string) {\n  if (turndownServices[rootUrl]) {\n    return turndownServices[rootUrl];\n  }\n  const turndownService = new TurndownService();\n  turndownService.addRule('strikethrough', {\n    filter: ['del', 's', 'strike'],\n    replacement(content: string): string {\n      return chalk.strikethrough(content);\n    },\n  });\n  turndownService.addRule('strong', {\n    filter: ['strong', 'b'],\n    replacement(content: string): string {\n      return chalk.bold(content);\n    },\n  });\n  turndownService.addRule('emphasis', {\n    filter: ['em', 'i'],\n    replacement(content: string): string {\n      return chalk.italic(content);\n    },\n  });\n  turndownService.addRule('heading', {\n    filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    replacement(content: string): string {\n      return '\\n' + chalk.bold(content) + '\\n';\n    },\n  });\n  turndownService.addRule('inlineLink', {\n    filter(node: any, options: any) {\n      return options.linkStyle === 'inlined' && node.nodeName === 'A' && node.getAttribute('href');\n    },\n    replacement(content: string, node: any) {\n      let href = node.getAttribute('href');\n      if (href.startsWith('/')) href = `${rootUrl}${href}`;\n      if (terminalLink.isSupported) {\n        return chalk.cyan(terminalLink(content, href));\n      }\n      return `${chalk.cyan(content)} (${chalk.underline(href)})`;\n    },\n  });\n\n  turndownServices[rootUrl] = turndownService;\n  return turndownService;\n}\n\nexport function convertHTMLToASCII({\n  content,\n  rootUrl,\n}: {\n  content: string;\n  rootUrl: string;\n}): string {\n  const service = getService(rootUrl);\n  return wrapAnsi(service.turndown(content), process.stdout.columns || 80);\n}\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAiC;AAFjC;;AAIA,MAAMA,gBAAqC,GAAG,CAAC,CAAC;AAEhD,SAASC,UAAU,CAACC,OAAe,EAAE;EACnC,IAAIF,gBAAgB,CAACE,OAAO,CAAC,EAAE;IAC7B,OAAOF,gBAAgB,CAACE,OAAO,CAAC;EAClC;EACA,MAAMC,eAAe,GAAG,KAAIC,mBAAe,GAAE;EAC7CD,eAAe,CAACE,OAAO,CAAC,eAAe,EAAE;IACvCC,MAAM,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,CAAC;IAC9BC,WAAW,CAACC,OAAe,EAAU;MACnC,OAAOC,gBAAK,CAACC,aAAa,CAACF,OAAO,CAAC;IACrC;EACF,CAAC,CAAC;EACFL,eAAe,CAACE,OAAO,CAAC,QAAQ,EAAE;IAChCC,MAAM,EAAE,CAAC,QAAQ,EAAE,GAAG,CAAC;IACvBC,WAAW,CAACC,OAAe,EAAU;MACnC,OAAOC,gBAAK,CAACE,IAAI,CAACH,OAAO,CAAC;IAC5B;EACF,CAAC,CAAC;EACFL,eAAe,CAACE,OAAO,CAAC,UAAU,EAAE;IAClCC,MAAM,EAAE,CAAC,IAAI,EAAE,GAAG,CAAC;IACnBC,WAAW,CAACC,OAAe,EAAU;MACnC,OAAOC,gBAAK,CAACG,MAAM,CAACJ,OAAO,CAAC;IAC9B;EACF,CAAC,CAAC;EACFL,eAAe,CAACE,OAAO,CAAC,SAAS,EAAE;IACjCC,MAAM,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;IAC5CC,WAAW,CAACC,OAAe,EAAU;MACnC,OAAO,IAAI,GAAGC,gBAAK,CAACE,IAAI,CAACH,OAAO,CAAC,GAAG,IAAI;IAC1C;EACF,CAAC,CAAC;EACFL,eAAe,CAACE,OAAO,CAAC,YAAY,EAAE;IACpCC,MAAM,CAACO,IAAS,EAAEC,OAAY,EAAE;MAC9B,OAAOA,OAAO,CAACC,SAAS,KAAK,SAAS,IAAIF,IAAI,CAACG,QAAQ,KAAK,GAAG,IAAIH,IAAI,CAACI,YAAY,CAAC,MAAM,CAAC;IAC9F,CAAC;IACDV,WAAW,CAACC,OAAe,EAAEK,IAAS,EAAE;MACtC,IAAIK,IAAI,GAAGL,IAAI,CAACI,YAAY,CAAC,MAAM,CAAC;MACpC,IAAIC,IAAI,CAACC,UAAU,CAAC,GAAG,CAAC,EAAED,IAAI,GAAI,GAAEhB,OAAQ,GAAEgB,IAAK,EAAC;MACpD,IAAIE,uBAAY,CAACC,WAAW,EAAE;QAC5B,OAAOZ,gBAAK,CAACa,IAAI,CAAC,IAAAF,uBAAY,EAACZ,OAAO,EAAEU,IAAI,CAAC,CAAC;MAChD;MACA,OAAQ,GAAET,gBAAK,CAACa,IAAI,CAACd,OAAO,CAAE,KAAIC,gBAAK,CAACc,SAAS,CAACL,IAAI,CAAE,GAAE;IAC5D;EACF,CAAC,CAAC;EAEFlB,gBAAgB,CAACE,OAAO,CAAC,GAAGC,eAAe;EAC3C,OAAOA,eAAe;AACxB;AAEO,SAASqB,kBAAkB,CAAC;EACjChB,OAAO;EACPN;AAIF,CAAC,EAAU;EACT,MAAMuB,OAAO,GAAGxB,UAAU,CAACC,OAAO,CAAC;EACnC,OAAO,IAAAwB,mBAAQ,EAACD,OAAO,CAACE,QAAQ,CAACnB,OAAO,CAAC,EAAEoB,OAAO,CAACC,MAAM,CAACC,OAAO,IAAI,EAAE,CAAC;AAC1E"}