{"version":3,"file":"keychain.js","names":["KEYCHAIN_TYPE","IS_MAC","process","platform","NO_PASSWORD_REGEX","EXPO_NO_KEYCHAIN","getenv","boolish","deletePasswordAsync","username","serviceName","Promise","resolve","reject","keychain","deletePassword","account","service","type","error","message","match","getPasswordAsync","getPassword","password","setPasswordAsync","setPassword"],"sources":["../../src/appleApi/keychain.ts"],"sourcesContent":["import getenv from 'getenv';\n// @ts-ignore\nimport keychain from 'keychain';\n\nconst KEYCHAIN_TYPE = 'internet';\nconst IS_MAC = process.platform === 'darwin';\nconst NO_PASSWORD_REGEX = /Could not find password/;\n\n// When enabled, the password will not only be skipped but also deleted.\n// This makes it easier to completely opt-out of Keychain functionality.\nexport const EXPO_NO_KEYCHAIN = getenv.boolish('EXPO_NO_KEYCHAIN', false);\n\ntype Credentials = {\n  serviceName: string;\n  username: string;\n  password: string;\n};\n\nexport function deletePasswordAsync({\n  username,\n  serviceName,\n}: Pick<Credentials, 'username' | 'serviceName'>): Promise<boolean> {\n  if (!IS_MAC) {\n    return Promise.resolve(false);\n  }\n\n  return new Promise((resolve, reject) => {\n    keychain.deletePassword(\n      { account: username, service: serviceName, type: KEYCHAIN_TYPE },\n      (error: Error) => {\n        if (error) {\n          if (error.message.match(NO_PASSWORD_REGEX)) {\n            return resolve(false);\n          }\n          reject(error);\n        } else {\n          resolve(true);\n        }\n      }\n    );\n  });\n}\n\nexport function getPasswordAsync({\n  username,\n  serviceName,\n}: Pick<Credentials, 'serviceName' | 'username'>): Promise<string | null> {\n  if (!IS_MAC) {\n    return Promise.resolve(null);\n  }\n\n  return new Promise((resolve, reject) => {\n    keychain.getPassword(\n      { account: username, service: serviceName, type: KEYCHAIN_TYPE },\n      (error: Error, password: string) => {\n        if (error) {\n          if (error.message.match(NO_PASSWORD_REGEX)) {\n            return resolve(null);\n          }\n          reject(error);\n        } else {\n          resolve(password);\n        }\n      }\n    );\n  });\n}\n\nexport function setPasswordAsync({\n  serviceName,\n  username,\n  password,\n}: Credentials): Promise<boolean> {\n  if (!IS_MAC) {\n    return Promise.resolve(false);\n  }\n  return new Promise((resolve, reject) => {\n    keychain.setPassword(\n      { account: username, service: serviceName, password, type: KEYCHAIN_TYPE },\n      (error: Error) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve(true);\n        }\n      }\n    );\n  });\n}\n"],"mappings":";;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAgC;AADhC;;AAGA,MAAMA,aAAa,GAAG,UAAU;AAChC,MAAMC,MAAM,GAAGC,OAAO,CAACC,QAAQ,KAAK,QAAQ;AAC5C,MAAMC,iBAAiB,GAAG,yBAAyB;;AAEnD;AACA;AACO,MAAMC,gBAAgB,GAAGC,iBAAM,CAACC,OAAO,CAAC,kBAAkB,EAAE,KAAK,CAAC;AAAC;AAQnE,SAASC,mBAAmB,CAAC;EAClCC,QAAQ;EACRC;AAC6C,CAAC,EAAoB;EAClE,IAAI,CAACT,MAAM,EAAE;IACX,OAAOU,OAAO,CAACC,OAAO,CAAC,KAAK,CAAC;EAC/B;EAEA,OAAO,IAAID,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtCC,mBAAQ,CAACC,cAAc,CACrB;MAAEC,OAAO,EAAEP,QAAQ;MAAEQ,OAAO,EAAEP,WAAW;MAAEQ,IAAI,EAAElB;IAAc,CAAC,EAC/DmB,KAAY,IAAK;MAChB,IAAIA,KAAK,EAAE;QACT,IAAIA,KAAK,CAACC,OAAO,CAACC,KAAK,CAACjB,iBAAiB,CAAC,EAAE;UAC1C,OAAOQ,OAAO,CAAC,KAAK,CAAC;QACvB;QACAC,MAAM,CAACM,KAAK,CAAC;MACf,CAAC,MAAM;QACLP,OAAO,CAAC,IAAI,CAAC;MACf;IACF,CAAC,CACF;EACH,CAAC,CAAC;AACJ;AAEO,SAASU,gBAAgB,CAAC;EAC/Bb,QAAQ;EACRC;AAC6C,CAAC,EAA0B;EACxE,IAAI,CAACT,MAAM,EAAE;IACX,OAAOU,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC;EAC9B;EAEA,OAAO,IAAID,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtCC,mBAAQ,CAACS,WAAW,CAClB;MAAEP,OAAO,EAAEP,QAAQ;MAAEQ,OAAO,EAAEP,WAAW;MAAEQ,IAAI,EAAElB;IAAc,CAAC,EAChE,CAACmB,KAAY,EAAEK,QAAgB,KAAK;MAClC,IAAIL,KAAK,EAAE;QACT,IAAIA,KAAK,CAACC,OAAO,CAACC,KAAK,CAACjB,iBAAiB,CAAC,EAAE;UAC1C,OAAOQ,OAAO,CAAC,IAAI,CAAC;QACtB;QACAC,MAAM,CAACM,KAAK,CAAC;MACf,CAAC,MAAM;QACLP,OAAO,CAACY,QAAQ,CAAC;MACnB;IACF,CAAC,CACF;EACH,CAAC,CAAC;AACJ;AAEO,SAASC,gBAAgB,CAAC;EAC/Bf,WAAW;EACXD,QAAQ;EACRe;AACW,CAAC,EAAoB;EAChC,IAAI,CAACvB,MAAM,EAAE;IACX,OAAOU,OAAO,CAACC,OAAO,CAAC,KAAK,CAAC;EAC/B;EACA,OAAO,IAAID,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtCC,mBAAQ,CAACY,WAAW,CAClB;MAAEV,OAAO,EAAEP,QAAQ;MAAEQ,OAAO,EAAEP,WAAW;MAAEc,QAAQ;MAAEN,IAAI,EAAElB;IAAc,CAAC,EACzEmB,KAAY,IAAK;MAChB,IAAIA,KAAK,EAAE;QACTN,MAAM,CAACM,KAAK,CAAC;MACf,CAAC,MAAM;QACLP,OAAO,CAAC,IAAI,CAAC;MACf;IACF,CAAC,CACF;EACH,CAAC,CAAC;AACJ"}