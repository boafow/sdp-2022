{"version":3,"file":"configureProjectAsync.js","names":["logConfig","config","isObjStr","str","test","Log","log","util","inspect","colors","compact","sorted","a","b","showHidden","depth","configureManagedProjectAsync","projectRoot","platforms","bundleIdentifier","includes","getOrPromptForBundleIdentifier","packageName","getOrPromptForPackage","exp","getPrebuildConfigAsync","expoUsername","getAccountUsername","compileModsAsync","assertMissingModProviders","isDebug","debug"],"sources":["../../../src/commands/eject/configureProjectAsync.ts"],"sourcesContent":["import { ExpoConfig, getAccountUsername, ProjectConfig } from '@expo/config';\nimport { compileModsAsync, ModPlatform } from '@expo/config-plugins';\nimport { getPrebuildConfigAsync } from '@expo/prebuild-config';\nimport util from 'util';\n\nimport Log from '../../log';\nimport {\n  getOrPromptForBundleIdentifier,\n  getOrPromptForPackage,\n} from '../utils/getOrPromptApplicationId';\n\nexport function logConfig(config: ExpoConfig | ProjectConfig) {\n  const isObjStr = (str: string): boolean => /^\\w+: {/g.test(str);\n  Log.log(\n    util.inspect(config, {\n      colors: true,\n      compact: false,\n      // Sort objects to the end so that smaller values aren't hidden between large objects.\n      sorted(a: string, b: string) {\n        if (isObjStr(a)) return 1;\n        if (isObjStr(b)) return -1;\n        return 0;\n      },\n      showHidden: false,\n      depth: null,\n    })\n  );\n}\n\nexport default async function configureManagedProjectAsync({\n  projectRoot,\n  platforms,\n}: {\n  projectRoot: string;\n  platforms: ModPlatform[];\n}) {\n  let bundleIdentifier: string | undefined;\n  if (platforms.includes('ios')) {\n    // Check bundle ID before reading the config because it may mutate the config if the user is prompted to define it.\n    bundleIdentifier = await getOrPromptForBundleIdentifier(projectRoot);\n  }\n  let packageName: string | undefined;\n  if (platforms.includes('android')) {\n    // Check package before reading the config because it may mutate the config if the user is prompted to define it.\n    packageName = await getOrPromptForPackage(projectRoot);\n  }\n\n  let { exp: config } = await getPrebuildConfigAsync(projectRoot, {\n    platforms,\n    packageName,\n    bundleIdentifier,\n    expoUsername(config) {\n      return getAccountUsername(config);\n    },\n  });\n\n  // compile all plugins and mods\n  config = await compileModsAsync(config, {\n    projectRoot,\n    platforms,\n    assertMissingModProviders: false,\n  });\n\n  if (Log.isDebug) {\n    Log.debug();\n    Log.debug('Evaluated config:');\n    logConfig(config);\n    Log.debug();\n  }\n\n  return config;\n}\n"],"mappings":";;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAG2C;AAEpC,SAASA,SAAS,CAACC,MAAkC,EAAE;EAC5D,MAAMC,QAAQ,GAAIC,GAAW,IAAc,UAAU,CAACC,IAAI,CAACD,GAAG,CAAC;EAC/DE,cAAG,CAACC,GAAG,CACLC,eAAI,CAACC,OAAO,CAACP,MAAM,EAAE;IACnBQ,MAAM,EAAE,IAAI;IACZC,OAAO,EAAE,KAAK;IACd;IACAC,MAAM,CAACC,CAAS,EAAEC,CAAS,EAAE;MAC3B,IAAIX,QAAQ,CAACU,CAAC,CAAC,EAAE,OAAO,CAAC;MACzB,IAAIV,QAAQ,CAACW,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;MAC1B,OAAO,CAAC;IACV,CAAC;IACDC,UAAU,EAAE,KAAK;IACjBC,KAAK,EAAE;EACT,CAAC,CAAC,CACH;AACH;AAEe,eAAeC,4BAA4B,CAAC;EACzDC,WAAW;EACXC;AAIF,CAAC,EAAE;EACD,IAAIC,gBAAoC;EACxC,IAAID,SAAS,CAACE,QAAQ,CAAC,KAAK,CAAC,EAAE;IAC7B;IACAD,gBAAgB,GAAG,MAAM,IAAAE,0DAA8B,EAACJ,WAAW,CAAC;EACtE;EACA,IAAIK,WAA+B;EACnC,IAAIJ,SAAS,CAACE,QAAQ,CAAC,SAAS,CAAC,EAAE;IACjC;IACAE,WAAW,GAAG,MAAM,IAAAC,iDAAqB,EAACN,WAAW,CAAC;EACxD;EAEA,IAAI;IAAEO,GAAG,EAAEvB;EAAO,CAAC,GAAG,MAAM,IAAAwB,wCAAsB,EAACR,WAAW,EAAE;IAC9DC,SAAS;IACTI,WAAW;IACXH,gBAAgB;IAChBO,YAAY,CAACzB,MAAM,EAAE;MACnB,OAAO,IAAA0B,4BAAkB,EAAC1B,MAAM,CAAC;IACnC;EACF,CAAC,CAAC;;EAEF;EACAA,MAAM,GAAG,MAAM,IAAA2B,iCAAgB,EAAC3B,MAAM,EAAE;IACtCgB,WAAW;IACXC,SAAS;IACTW,yBAAyB,EAAE;EAC7B,CAAC,CAAC;EAEF,IAAIxB,cAAG,CAACyB,OAAO,EAAE;IACfzB,cAAG,CAAC0B,KAAK,EAAE;IACX1B,cAAG,CAAC0B,KAAK,CAAC,mBAAmB,CAAC;IAC9B/B,SAAS,CAACC,MAAM,CAAC;IACjBI,cAAG,CAAC0B,KAAK,EAAE;EACb;EAEA,OAAO9B,MAAM;AACf"}