{"version":3,"file":"installNodeDependenciesAsync.js","names":["installNodeDependenciesAsync","projectRoot","packageManager","clean","cleanJsDepsStep","logNewSection","time","Date","now","fs","remove","succeed","chalk","gray","installJsDepsStep","CreateApp","message","bold","fail","red","SilentError"],"sources":["../../../src/commands/eject/installNodeDependenciesAsync.ts"],"sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs-extra';\n\nimport { SilentError } from '../../CommandError';\nimport { logNewSection } from '../../utils/ora';\nimport * as CreateApp from '../utils/CreateApp';\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nexport async function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean && packageManager !== 'yarn') {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = logNewSection('Cleaning JavaScript dependencies');\n    const time = Date.now();\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed(\n      `Cleaned JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  }\n\n  const installJsDepsStep = logNewSection('Installing JavaScript dependencies');\n  try {\n    const time = Date.now();\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed(\n      `Installed JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  } catch {\n    const message = `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n      `${packageManager} install`\n    )} again manually.`;\n    installJsDepsStep.fail(chalk.red(message));\n    // TODO: actually show the error message from the package manager! :O\n    throw new SilentError(message);\n  }\n}\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAgD;AAAA;AAAA;AAEhD;AACA;AACA;AACA;AACA;AACO,eAAeA,4BAA4B,CAChDC,WAAmB,EACnBC,cAA8B,EAC9B;EAAEC,KAAK,GAAG;AAAyB,CAAC,EACpC;EACA,IAAIA,KAAK,IAAID,cAAc,KAAK,MAAM,EAAE;IACtC;IACA;IACA,MAAME,eAAe,GAAG,IAAAC,oBAAa,EAAC,kCAAkC,CAAC;IACzE,MAAMC,IAAI,GAAGC,IAAI,CAACC,GAAG,EAAE;IACvB;IACA;IACA,MAAMC,kBAAE,CAACC,MAAM,CAAC,cAAc,CAAC;IAC/BN,eAAe,CAACO,OAAO,CACpB,mCAAkCC,gBAAK,CAACC,IAAI,CAACN,IAAI,CAACC,GAAG,EAAE,GAAGF,IAAI,GAAG,IAAI,CAAE,EAAC,CAC1E;EACH;EAEA,MAAMQ,iBAAiB,GAAG,IAAAT,oBAAa,EAAC,oCAAoC,CAAC;EAC7E,IAAI;IACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,GAAG,EAAE;IACvB,MAAMO,SAAS,GAACf,4BAA4B,CAACC,WAAW,EAAEC,cAAc,CAAC;IACzEY,iBAAiB,CAACH,OAAO,CACtB,qCAAoCC,gBAAK,CAACC,IAAI,CAACN,IAAI,CAACC,GAAG,EAAE,GAAGF,IAAI,GAAG,IAAI,CAAE,EAAC,CAC5E;EACH,CAAC,CAAC,MAAM;IACN,MAAMU,OAAO,GAAI,uEAAsEd,cAAe,mBAAkBU,gBAAK,CAACK,IAAI,CAC/H,GAAEf,cAAe,UAAS,CAC3B,kBAAiB;IACnBY,iBAAiB,CAACI,IAAI,CAACN,gBAAK,CAACO,GAAG,CAACH,OAAO,CAAC,CAAC;IAC1C;IACA,MAAM,KAAII,2BAAW,EAACJ,OAAO,CAAC;EAChC;AACF"}