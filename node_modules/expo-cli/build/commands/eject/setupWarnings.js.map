{"version":3,"file":"setupWarnings.js","names":["warnIfDependenciesRequireAdditionalSetup","pkg","sdkVersion","appliedPlugins","warnings","getSetupWarnings","autoPlugins","getLegacyExpoPlugins","logSetupWarnings","pkgsWithExtraSetup","filter","plugin","includes","reduce","prev","curr","semver","lte","chalk","bold","dim","learnMore","dependencies","key","warningLength","Object","keys","length","Log","newLine","warnAdditionalSetupStep","logNewSection","plural","stopAndPersist","symbol","text","yellow","pkgName","message","entries","nested"],"sources":["../../../src/commands/eject/setupWarnings.ts"],"sourcesContent":["import { PackageJSONConfig } from '@expo/config';\nimport { getLegacyExpoPlugins } from '@expo/prebuild-config';\nimport chalk from 'chalk';\nimport semver from 'semver';\n\nimport Log from '../../log';\nimport { logNewSection } from '../../utils/ora';\nimport { learnMore } from '../utils/TerminalLink';\n\n/**\n * Some packages are not configured automatically on eject and may require\n * users to add some code, eg: to their AppDelegate.\n */\nexport function warnIfDependenciesRequireAdditionalSetup(\n  pkg: PackageJSONConfig,\n  sdkVersion?: string,\n  appliedPlugins?: string[]\n): Record<string, string> {\n  const warnings = getSetupWarnings({\n    pkg,\n    sdkVersion,\n    appliedPlugins: appliedPlugins ?? [],\n    autoPlugins: getLegacyExpoPlugins(),\n  });\n\n  logSetupWarnings(warnings);\n\n  return warnings;\n}\n\n// Exposed for testing\nexport function getSetupWarnings({\n  pkg,\n  sdkVersion,\n  appliedPlugins,\n  autoPlugins,\n}: {\n  pkg: PackageJSONConfig;\n  sdkVersion?: string;\n  appliedPlugins: string[];\n  autoPlugins: string[];\n}): Record<string, string> {\n  const pkgsWithExtraSetup = autoPlugins\n    .filter(plugin => !appliedPlugins?.includes(plugin))\n    .reduce<Record<string, string>>(\n      (prev, curr) => ({\n        ...prev,\n        [curr]: `https://github.com/expo/expo/tree/master/packages/${curr}`,\n      }),\n      {}\n    );\n\n  // Starting with SDK 40 the manifest is embedded in ejected apps automatically\n  if (sdkVersion && semver.lte(sdkVersion, '39.0.0')) {\n    pkgsWithExtraSetup['expo-constants'] = `${chalk.bold(\n      'Constants.manifest'\n    )} is not available in the bare workflow. You should replace it with ${chalk.bold(\n      'Updates.manifest'\n    )}. ${chalk.dim(\n      learnMore('https://docs.expo.dev/versions/latest/sdk/updates/#updatesmanifest')\n    )}`;\n  }\n\n  const warnings: Record<string, string> = {};\n  if (pkg.dependencies) {\n    for (const key in pkg.dependencies) {\n      if (key in pkgsWithExtraSetup) {\n        warnings[key] = pkgsWithExtraSetup[key];\n      }\n    }\n  }\n  return warnings;\n}\n\nfunction logSetupWarnings(warnings: Record<string, string>) {\n  const warningLength = Object.keys(warnings).length;\n  if (!warningLength) {\n    return;\n  }\n\n  Log.newLine();\n  const warnAdditionalSetupStep = logNewSection(\n    'Checking if any additional setup steps are required for installed SDK packages.'\n  );\n\n  const plural = warningLength > 1;\n\n  warnAdditionalSetupStep.stopAndPersist({\n    symbol: '⚠️ ',\n    text: chalk.yellow.bold(\n      `The app has ${warningLength} package${plural ? 's' : ''} that require${\n        plural ? '' : 's'\n      } extra setup before building:`\n    ),\n  });\n\n  for (const [pkgName, message] of Object.entries(warnings)) {\n    Log.nested(`\\u203A ${chalk.bold(pkgName)}: ${message}`);\n  }\n}\n"],"mappings":"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"}