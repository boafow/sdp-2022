{"version":3,"file":"writeMetroConfig.js","names":["writeMetroConfig","projectRoot","pkg","tempDir","updatingMetroConfigStep","logNewSection","sourceConfigPath","path","join","targetConfigPath","targetConfigPathExists","fs","existsSync","contents","createFileHash","readFileSync","targetContents","CommandError","stop","clear","metro","copySync","succeed","e","stopAndPersist","symbol","text","chalk","yellow","Log","nested","message","bold","dim","learnMore","newLine"],"sources":["../../../src/commands/eject/writeMetroConfig.ts"],"sourcesContent":["import { PackageJSONConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport fs from 'fs-extra';\nimport path from 'path';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport { logNewSection } from '../../utils/ora';\nimport { learnMore } from '../utils/TerminalLink';\nimport { createFileHash } from './updatePackageJson';\n\nexport function writeMetroConfig({\n  projectRoot,\n  pkg,\n  tempDir,\n}: {\n  projectRoot: string;\n  pkg: PackageJSONConfig;\n  tempDir: string;\n}) {\n  /**\n   * Add metro config, or warn if metro config already exists. The developer will need to add the\n   * hashAssetFiles plugin manually.\n   */\n\n  const updatingMetroConfigStep = logNewSection('Adding Metro bundler config');\n\n  try {\n    const sourceConfigPath = path.join(tempDir, 'metro.config.js');\n    const targetConfigPath = path.join(projectRoot, 'metro.config.js');\n    const targetConfigPathExists = fs.existsSync(targetConfigPath);\n    if (targetConfigPathExists) {\n      // Prevent re-runs from throwing an error if the metro config hasn't been modified.\n      const contents = createFileHash(fs.readFileSync(targetConfigPath, 'utf8'));\n      const targetContents = createFileHash(fs.readFileSync(sourceConfigPath, 'utf8'));\n      if (contents !== targetContents) {\n        throw new CommandError('Existing Metro config found; not overwriting.');\n      } else {\n        // Nothing to change, hide the step and exit.\n        updatingMetroConfigStep.stop();\n        updatingMetroConfigStep.clear();\n        return;\n      }\n    } else if (\n      fs.existsSync(path.join(projectRoot, 'metro.config.json')) ||\n      pkg.metro ||\n      fs.existsSync(path.join(projectRoot, 'rn-cli.config.js'))\n    ) {\n      throw new CommandError('Existing Metro config found; not overwriting.');\n    }\n\n    fs.copySync(sourceConfigPath, targetConfigPath);\n    updatingMetroConfigStep.succeed('Added Metro config');\n  } catch (e: any) {\n    updatingMetroConfigStep.stopAndPersist({\n      symbol: '⚠️ ',\n      text: chalk.yellow('Skipped Metro config updates:'),\n    });\n    Log.nested(`\\u203A ${e.message}`);\n    Log.nested(\n      `\\u203A You will need to extend the default ${chalk.bold(\n        '@expo/metro-config'\n      )} in your Metro config.\\n  ${chalk.dim(\n        learnMore('https://docs.expo.dev/guides/customizing-metro')\n      )}`\n    );\n    Log.newLine();\n  }\n}\n"],"mappings":";;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAqD;AAE9C,SAASA,gBAAgB,CAAC;EAC/BC,WAAW;EACXC,GAAG;EACHC;AAKF,CAAC,EAAE;EACD;AACF;AACA;AACA;;EAEE,MAAMC,uBAAuB,GAAG,IAAAC,oBAAa,EAAC,6BAA6B,CAAC;EAE5E,IAAI;IACF,MAAMC,gBAAgB,GAAGC,eAAI,CAACC,IAAI,CAACL,OAAO,EAAE,iBAAiB,CAAC;IAC9D,MAAMM,gBAAgB,GAAGF,eAAI,CAACC,IAAI,CAACP,WAAW,EAAE,iBAAiB,CAAC;IAClE,MAAMS,sBAAsB,GAAGC,kBAAE,CAACC,UAAU,CAACH,gBAAgB,CAAC;IAC9D,IAAIC,sBAAsB,EAAE;MAC1B;MACA,MAAMG,QAAQ,GAAG,IAAAC,mCAAc,EAACH,kBAAE,CAACI,YAAY,CAACN,gBAAgB,EAAE,MAAM,CAAC,CAAC;MAC1E,MAAMO,cAAc,GAAG,IAAAF,mCAAc,EAACH,kBAAE,CAACI,YAAY,CAACT,gBAAgB,EAAE,MAAM,CAAC,CAAC;MAChF,IAAIO,QAAQ,KAAKG,cAAc,EAAE;QAC/B,MAAM,KAAIC,uBAAY,EAAC,+CAA+C,CAAC;MACzE,CAAC,MAAM;QACL;QACAb,uBAAuB,CAACc,IAAI,EAAE;QAC9Bd,uBAAuB,CAACe,KAAK,EAAE;QAC/B;MACF;IACF,CAAC,MAAM,IACLR,kBAAE,CAACC,UAAU,CAACL,eAAI,CAACC,IAAI,CAACP,WAAW,EAAE,mBAAmB,CAAC,CAAC,IAC1DC,GAAG,CAACkB,KAAK,IACTT,kBAAE,CAACC,UAAU,CAACL,eAAI,CAACC,IAAI,CAACP,WAAW,EAAE,kBAAkB,CAAC,CAAC,EACzD;MACA,MAAM,KAAIgB,uBAAY,EAAC,+CAA+C,CAAC;IACzE;IAEAN,kBAAE,CAACU,QAAQ,CAACf,gBAAgB,EAAEG,gBAAgB,CAAC;IAC/CL,uBAAuB,CAACkB,OAAO,CAAC,oBAAoB,CAAC;EACvD,CAAC,CAAC,OAAOC,CAAM,EAAE;IACfnB,uBAAuB,CAACoB,cAAc,CAAC;MACrCC,MAAM,EAAE,KAAK;MACbC,IAAI,EAAEC,gBAAK,CAACC,MAAM,CAAC,+BAA+B;IACpD,CAAC,CAAC;IACFC,cAAG,CAACC,MAAM,CAAE,UAASP,CAAC,CAACQ,OAAQ,EAAC,CAAC;IACjCF,cAAG,CAACC,MAAM,CACP,8CAA6CH,gBAAK,CAACK,IAAI,CACtD,oBAAoB,CACpB,6BAA4BL,gBAAK,CAACM,GAAG,CACrC,IAAAC,yBAAS,EAAC,gDAAgD,CAAC,CAC3D,EAAC,CACJ;IACDL,cAAG,CAACM,OAAO,EAAE;EACf;AACF"}