{"version":3,"file":"publishHistoryAsync.js","names":["HORIZ_CELL_WIDTH_SMALL","HORIZ_CELL_WIDTH_MEDIUM","HORIZ_CELL_WIDTH_BIG","actionAsync","projectRoot","options","result","getPublishHistoryAsync","raw","Log","log","JSON","stringify","queryResult","length","sampleItem","generalTableString","table","printTableJson","fullName","hasRuntimeVersion","some","publication","runtimeVersion","hasSdkVersion","sdkVersion","headers","colWidths","bigCells","Set","mediumCells","forEach","header","has","push","resultRows","map","publishedTime","dateFormat","tableString","printTableJsonArray","Error"],"sources":["../../../src/commands/publish/publishHistoryAsync.ts"],"sourcesContent":["import dateFormat from 'dateformat';\n\nimport Log from '../../log';\nimport { getPublishHistoryAsync, HistoryOptions, Publication } from '../utils/PublishUtils';\nimport * as table from '../utils/cli-table';\n\nconst HORIZ_CELL_WIDTH_SMALL = 15;\nconst HORIZ_CELL_WIDTH_MEDIUM = 20;\nconst HORIZ_CELL_WIDTH_BIG = 40;\n\nexport async function actionAsync(projectRoot: string, options: HistoryOptions) {\n  const result = await getPublishHistoryAsync(projectRoot, options);\n\n  if (options.raw) {\n    Log.log(JSON.stringify(result));\n    return;\n  }\n\n  if (result.queryResult && result.queryResult.length > 0) {\n    // Print general publication info\n    const sampleItem = result.queryResult[0]; // get a sample item\n    const generalTableString = table.printTableJson(\n      {\n        fullName: sampleItem.fullName,\n      },\n      'General Info'\n    );\n    Log.log(generalTableString);\n\n    const hasRuntimeVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.runtimeVersion\n    );\n    const hasSdkVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.sdkVersion\n    );\n\n    // Print info specific to each publication\n    const headers = [\n      'publishedTime',\n      'appVersion',\n      ...(hasSdkVersion ? ['sdkVersion'] : []),\n      ...(hasRuntimeVersion ? ['runtimeVersion'] : []),\n      'platform',\n      'channel',\n      'publicationId',\n    ];\n\n    // colWidths contains the cell size of each header\n    const colWidths: number[] = [];\n    const bigCells = new Set(['publicationId', 'publishedTime', 'channel']);\n    const mediumCells = new Set(['runtimeVersion']);\n    headers.forEach(header => {\n      if (bigCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_BIG);\n      } else if (mediumCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_MEDIUM);\n      } else {\n        colWidths.push(HORIZ_CELL_WIDTH_SMALL);\n      }\n    });\n    const resultRows: Publication[] = result.queryResult.map((publication: Publication) => ({\n      ...publication,\n      publishedTime: dateFormat(publication.publishedTime, 'ddd mmm dd yyyy HH:MM:ss Z'),\n    }));\n    const tableString = table.printTableJsonArray(headers, resultRows, colWidths);\n    Log.log(tableString);\n  } else {\n    throw new Error('No records found matching your query.');\n  }\n}\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA4C;AAAA;AAAA;AAE5C,MAAMA,sBAAsB,GAAG,EAAE;AACjC,MAAMC,uBAAuB,GAAG,EAAE;AAClC,MAAMC,oBAAoB,GAAG,EAAE;AAExB,eAAeC,WAAW,CAACC,WAAmB,EAAEC,OAAuB,EAAE;EAC9E,MAAMC,MAAM,GAAG,MAAM,IAAAC,sCAAsB,EAACH,WAAW,EAAEC,OAAO,CAAC;EAEjE,IAAIA,OAAO,CAACG,GAAG,EAAE;IACfC,cAAG,CAACC,GAAG,CAACC,IAAI,CAACC,SAAS,CAACN,MAAM,CAAC,CAAC;IAC/B;EACF;EAEA,IAAIA,MAAM,CAACO,WAAW,IAAIP,MAAM,CAACO,WAAW,CAACC,MAAM,GAAG,CAAC,EAAE;IACvD;IACA,MAAMC,UAAU,GAAGT,MAAM,CAACO,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;IAC1C,MAAMG,kBAAkB,GAAGC,KAAK,GAACC,cAAc,CAC7C;MACEC,QAAQ,EAAEJ,UAAU,CAACI;IACvB,CAAC,EACD,cAAc,CACf;IACDV,cAAG,CAACC,GAAG,CAACM,kBAAkB,CAAC;IAE3B,MAAMI,iBAAiB,GAAGd,MAAM,CAACO,WAAW,CAACQ,IAAI,CAC9CC,WAAwB,IAAK,CAAC,CAACA,WAAW,CAACC,cAAc,CAC3D;IACD,MAAMC,aAAa,GAAGlB,MAAM,CAACO,WAAW,CAACQ,IAAI,CAC1CC,WAAwB,IAAK,CAAC,CAACA,WAAW,CAACG,UAAU,CACvD;;IAED;IACA,MAAMC,OAAO,GAAG,CACd,eAAe,EACf,YAAY,EACZ,IAAIF,aAAa,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC,EACxC,IAAIJ,iBAAiB,GAAG,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,EAChD,UAAU,EACV,SAAS,EACT,eAAe,CAChB;;IAED;IACA,MAAMO,SAAmB,GAAG,EAAE;IAC9B,MAAMC,QAAQ,GAAG,IAAIC,GAAG,CAAC,CAAC,eAAe,EAAE,eAAe,EAAE,SAAS,CAAC,CAAC;IACvE,MAAMC,WAAW,GAAG,IAAID,GAAG,CAAC,CAAC,gBAAgB,CAAC,CAAC;IAC/CH,OAAO,CAACK,OAAO,CAACC,MAAM,IAAI;MACxB,IAAIJ,QAAQ,CAACK,GAAG,CAACD,MAAM,CAAC,EAAE;QACxBL,SAAS,CAACO,IAAI,CAAChC,oBAAoB,CAAC;MACtC,CAAC,MAAM,IAAI4B,WAAW,CAACG,GAAG,CAACD,MAAM,CAAC,EAAE;QAClCL,SAAS,CAACO,IAAI,CAACjC,uBAAuB,CAAC;MACzC,CAAC,MAAM;QACL0B,SAAS,CAACO,IAAI,CAAClC,sBAAsB,CAAC;MACxC;IACF,CAAC,CAAC;IACF,MAAMmC,UAAyB,GAAG7B,MAAM,CAACO,WAAW,CAACuB,GAAG,CAAEd,WAAwB,KAAM;MACtF,GAAGA,WAAW;MACde,aAAa,EAAE,IAAAC,qBAAU,EAAChB,WAAW,CAACe,aAAa,EAAE,4BAA4B;IACnF,CAAC,CAAC,CAAC;IACH,MAAME,WAAW,GAAGtB,KAAK,GAACuB,mBAAmB,CAACd,OAAO,EAAES,UAAU,EAAER,SAAS,CAAC;IAC7ElB,cAAG,CAACC,GAAG,CAAC6B,WAAW,CAAC;EACtB,CAAC,MAAM;IACL,MAAM,IAAIE,KAAK,CAAC,uCAAuC,CAAC;EAC1D;AACF"}