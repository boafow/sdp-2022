{"version":3,"file":"spawnGradleAsync.js","names":["upperFirst","name","charAt","toUpperCase","slice","formatGradleArguments","cmd","appName","variant","tasks","map","task","resolveGradleWPath","androidProjectPath","path","join","process","platform","getPortArg","port","assembleAsync","args","push","Log","isProfiling","spawnGradleAsync","installAsync","projectRoot","gradlew","debug","spawnAsync","cwd","stdio","error","status","AbortCommandError"],"sources":["../../../../src/commands/run/android/spawnGradleAsync.ts"],"sourcesContent":["import spawnAsync from '@expo/spawn-async';\nimport path from 'path';\n\nimport { AbortCommandError } from '../../../CommandError';\nimport Log from '../../../log';\n\nfunction upperFirst(name: string) {\n  return name.charAt(0).toUpperCase() + name.slice(1);\n}\n\nfunction formatGradleArguments(\n  cmd: 'assemble' | 'install',\n  {\n    appName,\n    variant,\n    tasks = [cmd + upperFirst(variant)],\n  }: { tasks?: string[]; variant: string; appName: string }\n) {\n  return appName ? tasks.map(task => `${appName}:${task}`) : tasks;\n}\n\nfunction resolveGradleWPath(androidProjectPath: string): string {\n  return path.join(androidProjectPath, process.platform === 'win32' ? 'gradlew.bat' : 'gradlew');\n}\n\nfunction getPortArg(port: number) {\n  return `-PreactNativeDevServerPort=${port}`;\n}\n\nexport async function assembleAsync({\n  androidProjectPath,\n  variant,\n  port,\n  appName,\n}: {\n  androidProjectPath: string;\n  variant: string;\n  port?: number;\n  appName: string;\n}) {\n  const task = formatGradleArguments('assemble', { variant, appName });\n  const args = [\n    ...task,\n    // ignore linting errors\n    '-x',\n    'lint',\n    // ignore tests\n    '-x',\n    'test',\n    '--configure-on-demand',\n  ];\n  if (port) args.push(getPortArg(port));\n\n  // Generate a profile under `/android/app/build/reports/profile`\n  if (Log.isProfiling) args.push('--profile');\n\n  return await spawnGradleAsync(androidProjectPath, { port, args });\n}\n\nexport async function installAsync({\n  androidProjectPath,\n  variant,\n  appName,\n  port,\n}: {\n  androidProjectPath: string;\n  variant: string;\n  appName: string;\n  port?: number;\n}) {\n  const args = formatGradleArguments('install', { variant, appName });\n  return await spawnGradleAsync(androidProjectPath, { port, args });\n}\n\nexport async function spawnGradleAsync(\n  projectRoot: string,\n  { port, args }: { port?: number; args: string[] }\n) {\n  const gradlew = resolveGradleWPath(projectRoot);\n  if (port) args.push(getPortArg(port));\n  Log.debug(`  ${gradlew} ${args.join(' ')}`);\n  try {\n    return await spawnAsync(gradlew, args, {\n      cwd: projectRoot,\n      stdio: 'inherit',\n    });\n  } catch (error: any) {\n    // User aborted the command with ctrl-c\n    if (error.status === 130) {\n      // Fail silently\n      throw new AbortCommandError();\n    }\n    throw error;\n  }\n}\n"],"mappings":";;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA+B;AAE/B,SAASA,UAAU,CAACC,IAAY,EAAE;EAChC,OAAOA,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,EAAE,GAAGF,IAAI,CAACG,KAAK,CAAC,CAAC,CAAC;AACrD;AAEA,SAASC,qBAAqB,CAC5BC,GAA2B,EAC3B;EACEC,OAAO;EACPC,OAAO;EACPC,KAAK,GAAG,CAACH,GAAG,GAAGN,UAAU,CAACQ,OAAO,CAAC;AACoB,CAAC,EACzD;EACA,OAAOD,OAAO,GAAGE,KAAK,CAACC,GAAG,CAACC,IAAI,IAAK,GAAEJ,OAAQ,IAAGI,IAAK,EAAC,CAAC,GAAGF,KAAK;AAClE;AAEA,SAASG,kBAAkB,CAACC,kBAA0B,EAAU;EAC9D,OAAOC,eAAI,CAACC,IAAI,CAACF,kBAAkB,EAAEG,OAAO,CAACC,QAAQ,KAAK,OAAO,GAAG,aAAa,GAAG,SAAS,CAAC;AAChG;AAEA,SAASC,UAAU,CAACC,IAAY,EAAE;EAChC,OAAQ,8BAA6BA,IAAK,EAAC;AAC7C;AAEO,eAAeC,aAAa,CAAC;EAClCP,kBAAkB;EAClBL,OAAO;EACPW,IAAI;EACJZ;AAMF,CAAC,EAAE;EACD,MAAMI,IAAI,GAAGN,qBAAqB,CAAC,UAAU,EAAE;IAAEG,OAAO;IAAED;EAAQ,CAAC,CAAC;EACpE,MAAMc,IAAI,GAAG,CACX,GAAGV,IAAI;EACP;EACA,IAAI,EACJ,MAAM;EACN;EACA,IAAI,EACJ,MAAM,EACN,uBAAuB,CACxB;EACD,IAAIQ,IAAI,EAAEE,IAAI,CAACC,IAAI,CAACJ,UAAU,CAACC,IAAI,CAAC,CAAC;;EAErC;EACA,IAAII,cAAG,CAACC,WAAW,EAAEH,IAAI,CAACC,IAAI,CAAC,WAAW,CAAC;EAE3C,OAAO,MAAMG,gBAAgB,CAACZ,kBAAkB,EAAE;IAAEM,IAAI;IAAEE;EAAK,CAAC,CAAC;AACnE;AAEO,eAAeK,YAAY,CAAC;EACjCb,kBAAkB;EAClBL,OAAO;EACPD,OAAO;EACPY;AAMF,CAAC,EAAE;EACD,MAAME,IAAI,GAAGhB,qBAAqB,CAAC,SAAS,EAAE;IAAEG,OAAO;IAAED;EAAQ,CAAC,CAAC;EACnE,OAAO,MAAMkB,gBAAgB,CAACZ,kBAAkB,EAAE;IAAEM,IAAI;IAAEE;EAAK,CAAC,CAAC;AACnE;AAEO,eAAeI,gBAAgB,CACpCE,WAAmB,EACnB;EAAER,IAAI;EAAEE;AAAwC,CAAC,EACjD;EACA,MAAMO,OAAO,GAAGhB,kBAAkB,CAACe,WAAW,CAAC;EAC/C,IAAIR,IAAI,EAAEE,IAAI,CAACC,IAAI,CAACJ,UAAU,CAACC,IAAI,CAAC,CAAC;EACrCI,cAAG,CAACM,KAAK,CAAE,KAAID,OAAQ,IAAGP,IAAI,CAACN,IAAI,CAAC,GAAG,CAAE,EAAC,CAAC;EAC3C,IAAI;IACF,OAAO,MAAM,IAAAe,qBAAU,EAACF,OAAO,EAAEP,IAAI,EAAE;MACrCU,GAAG,EAAEJ,WAAW;MAChBK,KAAK,EAAE;IACT,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOC,KAAU,EAAE;IACnB;IACA,IAAIA,KAAK,CAACC,MAAM,KAAK,GAAG,EAAE;MACxB;MACA,MAAM,KAAIC,iCAAiB,GAAE;IAC/B;IACA,MAAMF,KAAK;EACb;AACF"}