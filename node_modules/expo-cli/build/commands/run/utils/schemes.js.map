{"version":3,"file":"schemes.js","names":["getSchemesForIosAsync","projectRoot","configPath","IOSConfig","Paths","getInfoPlistPath","rawPlist","fs","readFileSync","plistObject","plist","parse","sortLongest","Scheme","getSchemesFromPlist","getSchemesForAndroidAsync","AndroidConfig","getAndroidManifestAsync","manifest","Manifest","readAndroidManifestAsync","getSchemesFromManifest","intersecting","a","b","c","d","length","filter","value","includes","getOptionalDevClientSchemeAsync","hasIos","hasAndroid","Promise","all","hasRequiredIOSFilesAsync","hasRequiredAndroidFilesAsync","ios","android","getManagedDevClientSchemeAsync","matching","exp","getConfig","skipSDKVersionRequirement","getDefaultScheme","require","resolveFrom","scheme","Log","warn","obj","sort"],"sources":["../../../../src/commands/run/utils/schemes.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport { AndroidConfig, IOSConfig } from '@expo/config-plugins';\nimport plist from '@expo/plist';\nimport fs from 'fs';\nimport resolveFrom from 'resolve-from';\n\nimport Log from '../../../log';\nimport {\n  hasRequiredAndroidFilesAsync,\n  hasRequiredIOSFilesAsync,\n} from '../../eject/clearNativeFolder';\n\nexport async function getSchemesForIosAsync(projectRoot: string) {\n  try {\n    const configPath = IOSConfig.Paths.getInfoPlistPath(projectRoot);\n    const rawPlist = fs.readFileSync(configPath, 'utf8');\n    const plistObject = plist.parse(rawPlist);\n    return sortLongest(IOSConfig.Scheme.getSchemesFromPlist(plistObject));\n  } catch {\n    // No ios folder or some other error\n    return [];\n  }\n}\n\nexport async function getSchemesForAndroidAsync(projectRoot: string) {\n  try {\n    const configPath = await AndroidConfig.Paths.getAndroidManifestAsync(projectRoot);\n    const manifest = await AndroidConfig.Manifest.readAndroidManifestAsync(configPath);\n    return sortLongest(\n      await AndroidConfig.Scheme.getSchemesFromManifest(manifest, 'expo-development-client')\n    );\n  } catch {\n    // No android folder or some other error\n    return [];\n  }\n}\n\nfunction intersecting<T>(a: T[], b: T[]): T[] {\n  const [c, d] = a.length > b.length ? [a, b] : [b, a];\n  return c.filter(value => d.includes(value));\n}\n\nexport async function getOptionalDevClientSchemeAsync(projectRoot: string): Promise<string | null> {\n  const [hasIos, hasAndroid] = await Promise.all([\n    hasRequiredIOSFilesAsync(projectRoot),\n    hasRequiredAndroidFilesAsync(projectRoot),\n  ]);\n\n  const [ios, android] = await Promise.all([\n    getSchemesForIosAsync(projectRoot),\n    getSchemesForAndroidAsync(projectRoot),\n  ]);\n\n  // Allow managed projects\n  if (!hasIos && !hasAndroid) {\n    return getManagedDevClientSchemeAsync(projectRoot);\n  }\n\n  let matching: string;\n  // Allow for only one native project to exist.\n  if (!hasIos) {\n    matching = android[0];\n  } else if (!hasAndroid) {\n    matching = ios[0];\n  } else {\n    [matching] = intersecting(ios, android);\n  }\n  return matching ?? null;\n}\n\nasync function getManagedDevClientSchemeAsync(projectRoot: string): Promise<string | null> {\n  const { exp } = getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n  });\n  try {\n    const getDefaultScheme = require(resolveFrom(projectRoot, 'expo-dev-client/getDefaultScheme'));\n    const scheme = getDefaultScheme(exp);\n    return scheme;\n  } catch {\n    Log.warn(\n      '\\nDevelopment build: Unable to get the default URI scheme for the project. Please make sure the expo-dev-client package is installed.'\n    );\n    // throw new CommandError(error);\n    return null;\n  }\n}\n\n// sort longest to ensure uniqueness.\n// this might be undesirable as it causes the QR code to be longer.\nfunction sortLongest(obj: string[]): string[] {\n  return obj.sort((a, b) => b.length - a.length);\n}\n"],"mappings":"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"}