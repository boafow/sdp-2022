{"version":3,"file":"TerminalUI.js","names":["CTRL_C","CTRL_D","CTRL_L","BLT","bold","b","italic","i","underline","u","chalk","printHelp","logCommandsTable","key","msg","div","dim","printUsageAsync","projectRoot","options","dev","ProjectSettings","readAsync","devMode","isMac","process","platform","platforms","isAndroidDisabled","includes","isIosDisabled","isWebDisable","disabled","isRemoteReloadingEnabled","isWebSocketsEnabled","status","printBasicUsageAsync","ui","Log","nested","filter","Boolean","map","view","length","join","printServerInfo","wrapLength","stdout","columns","item","text","wrapAnsi","trimStart","webOnly","url","UrlUtils","constructDeepLinkAsync","getURLForQR","devClient","Env","isInterstitiaLPageEnabled","isDevClientPackageInstalled","constructLoadingUrlAsync","urlOpts","printQRCode","error","code","serverUrl","constructManifestUrlAsync","urlType","webUrl","Webpack","getUrlAsync","addNewLineIfNone","gray","openJsInsectorAsync","log","packagerPort","readPackagerInfoAsync","metroServerOrigin","apps","queryAllInspectorAppsAsync","warn","learnMore","app","openJsInspector","startAsync","stdin","startWaitingForCommand","setRawMode","resume","setEncoding","on","handleKeypress","stopWaitingForCommand","removeListener","Prompts","addInteractionListener","pause","UserManager","setInteractiveAuthenticationCallback","loginOrRegisterIfLoggedOutAsync","handleKeypressAsync","err","handleErrorsAsync","exit","shouldPrompt","nonInteractive","clear","results","Android","openWebProjectAsync","success","nestedError","isDisabled","nestedWarn","openProjectAsync","message","Simulator","emit","pauseInteractions","ensureWebSupportSetupAsync","push","e","isStarted","Project","openAsync","broadcastMessage","value","selectAsync","choices","title","name","resumeInteractions","projectSettings","setAsync","minify","reset","openInEditorAsync","editor","env","EXPO_EDITOR"],"sources":["../../../src/commands/start/TerminalUI.ts"],"sourcesContent":["import { ExpoConfig } from '@expo/config-types';\nimport { openJsInspector, queryAllInspectorAppsAsync } from '@expo/dev-server';\nimport chalk from 'chalk';\nimport wrapAnsi from 'wrap-ansi';\nimport {\n  Android,\n  Env,\n  isDevClientPackageInstalled,\n  Project,\n  ProjectSettings,\n  Prompts,\n  Simulator,\n  UrlUtils,\n  UserManager,\n  Webpack,\n} from 'xdl';\n\nimport Log from '../../log';\nimport { handleErrorsAsync } from '../../utils/handleErrors';\nimport { selectAsync } from '../../utils/prompts';\nimport { loginOrRegisterIfLoggedOutAsync } from '../auth/accounts';\nimport { learnMore } from '../utils/TerminalLink';\nimport { openInEditorAsync } from '../utils/openInEditorAsync';\nimport urlOpts from '../utils/urlOpts';\nimport { ensureWebSupportSetupAsync } from '../utils/web/ensureWebSetup';\n\nconst CTRL_C = '\\u0003';\nconst CTRL_D = '\\u0004';\nconst CTRL_L = '\\u000C';\n\nconst BLT = `\\u203A`;\nconst { bold: b, italic: i, underline: u } = chalk;\n\ntype StartOptions = {\n  isWebSocketsEnabled?: boolean;\n  isRemoteReloadingEnabled?: boolean;\n  devClient?: boolean;\n  reset?: boolean;\n  nonInteractive?: boolean;\n  nonPersistent?: boolean;\n  maxWorkers?: number;\n  webOnly?: boolean;\n  platforms?: ExpoConfig['platforms'];\n};\n\nconst printHelp = (): void => {\n  logCommandsTable([{ key: '?', msg: 'show all commands' }]);\n};\n\nconst div = chalk.dim(`â”‚`);\n\nconst printUsageAsync = async (\n  projectRoot: string,\n  options: Pick<\n    StartOptions,\n    'webOnly' | 'devClient' | 'isWebSocketsEnabled' | 'isRemoteReloadingEnabled' | 'platforms'\n  >\n) => {\n  const { dev } = await ProjectSettings.readAsync(projectRoot);\n  const devMode = dev ? 'development' : 'production';\n\n  const isMac = process.platform === 'darwin';\n\n  const { platforms = ['ios', 'android', 'web'] } = options;\n\n  const isAndroidDisabled = !platforms.includes('android');\n  const isIosDisabled = !platforms.includes('ios');\n  const isWebDisable = !platforms.includes('web');\n\n  logCommandsTable([\n    {},\n    { key: 'a', msg: `open Android`, disabled: isAndroidDisabled },\n    { key: 'shift+a', msg: `select a device or emulator`, disabled: isAndroidDisabled },\n    isMac && { key: 'i', msg: `open iOS simulator`, disabled: isIosDisabled },\n    isMac && { key: 'shift+i', msg: `select a simulator`, disabled: isIosDisabled },\n    { key: 'w', msg: `open web`, disabled: isWebDisable },\n    {},\n    !!options.isRemoteReloadingEnabled && { key: 'r', msg: `reload app` },\n    !!options.isWebSocketsEnabled && { key: 'm', msg: `toggle menu` },\n    !!options.isWebSocketsEnabled && { key: 'shift+m', msg: `more tools` },\n    !!options.isWebSocketsEnabled && { key: 'j', msg: `open JavaScript inspector for Hermes` },\n    { key: 'o', msg: `open project code in your editor` },\n    { key: 'c', msg: `show project QR` },\n    { key: 'p', msg: `toggle build mode`, status: devMode },\n    // TODO: Drop with SDK 40\n    !options.isRemoteReloadingEnabled && { key: 'r', msg: `restart bundler` },\n    !options.isRemoteReloadingEnabled && { key: 'shift+r', msg: `restart and clear cache` },\n    {},\n  ]);\n};\n\nconst printBasicUsageAsync = async (\n  options: Pick<\n    StartOptions,\n    'webOnly' | 'isWebSocketsEnabled' | 'isRemoteReloadingEnabled' | 'platforms'\n  >\n) => {\n  const isMac = process.platform === 'darwin';\n\n  const { platforms = ['ios', 'android', 'web'] } = options;\n\n  const isAndroidDisabled = !platforms.includes('android');\n  const isIosDisabled = !platforms.includes('ios');\n  const isWebDisable = !platforms.includes('web');\n\n  logCommandsTable([\n    {},\n    { key: 'a', msg: `open Android`, disabled: isAndroidDisabled },\n    isMac && { key: 'i', msg: `open iOS simulator`, disabled: isIosDisabled },\n    { key: 'w', msg: `open web`, disabled: isWebDisable },\n    {},\n    !!options.isRemoteReloadingEnabled && { key: 'r', msg: `reload app` },\n    !!options.isWebSocketsEnabled && { key: 'm', msg: `toggle menu` },\n    {},\n  ]);\n};\n\nfunction logCommandsTable(\n  ui: (false | { key?: string; msg?: string; status?: string; disabled?: boolean })[]\n) {\n  Log.nested(\n    ui\n      .filter(Boolean)\n      // @ts-ignore: filter doesn't work\n      .map(({ key, msg, status, disabled }) => {\n        if (!key) return '';\n        let view = `${BLT} `;\n        if (key.length === 1) view += 'Press ';\n        view += `${b(key)} ${div} `;\n        view += msg;\n        if (status) {\n          view += ` ${chalk.dim(`(${i(status)})`)}`;\n        }\n        if (disabled) {\n          view = chalk.dim(view);\n        }\n        return view;\n      })\n      .join('\\n')\n  );\n}\n\nconst printServerInfo = async (\n  projectRoot: string,\n  options: Pick<\n    StartOptions,\n    'webOnly' | 'isWebSocketsEnabled' | 'isRemoteReloadingEnabled' | 'platforms'\n  >\n) => {\n  const wrapLength = process.stdout.columns || 80;\n  const item = (text: string): string => `${BLT} ` + wrapAnsi(text, wrapLength).trimStart();\n\n  if (!options.webOnly) {\n    try {\n      const url = await UrlUtils.constructDeepLinkAsync(projectRoot);\n\n      const getURLForQR = async () => {\n        const { devClient } = await ProjectSettings.readAsync(projectRoot);\n        if (\n          Env.isInterstitiaLPageEnabled() &&\n          !devClient &&\n          (await isDevClientPackageInstalled(projectRoot))\n        ) {\n          return await UrlUtils.constructLoadingUrlAsync(projectRoot, null);\n        } else {\n          return url;\n        }\n      };\n\n      urlOpts.printQRCode(await getURLForQR());\n      Log.nested(item(`Metro waiting on ${u(url)}`));\n      // Log.newLine();\n      // TODO: if development build, change this message!\n      Log.nested(item(`Scan the QR code above with Expo Go (Android) or the Camera app (iOS)`));\n    } catch (error: any) {\n      // @ts-ignore: If there is no development build scheme, then skip the QR code.\n      if (error.code !== 'NO_DEV_CLIENT_SCHEME') {\n        throw error;\n      } else {\n        const serverUrl = await UrlUtils.constructManifestUrlAsync(projectRoot, {\n          urlType: 'http',\n        });\n        Log.nested(item(`Metro waiting on ${u(serverUrl)}`));\n        Log.nested(item(`Linking is disabled because the client scheme cannot be resolved.`));\n      }\n    }\n  }\n\n  const webUrl = await Webpack.getUrlAsync(projectRoot);\n  if (webUrl) {\n    Log.addNewLineIfNone();\n    Log.nested(item(`Webpack waiting on ${u(webUrl)}`));\n    Log.nested(chalk.gray(item(`Expo Webpack (web) is in beta, and subject to breaking changes!`)));\n  }\n\n  await printBasicUsageAsync(options);\n  printHelp();\n  Log.addNewLineIfNone();\n};\n\nasync function openJsInsectorAsync(projectRoot: string) {\n  Log.log(`Opening JavaScript inspector in the browser...`);\n  const { packagerPort } = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  const metroServerOrigin = `http://localhost:${packagerPort}`;\n  const apps = await queryAllInspectorAppsAsync(metroServerOrigin);\n  if (apps.length === 0) {\n    Log.warn(\n      `No compatible apps connected. This feature is only available for apps using the Hermes runtime. ${learnMore(\n        'https://docs.expo.dev/guides/using-hermes/'\n      )}`\n    );\n    return;\n  }\n  for (const app of apps) {\n    openJsInspector(app);\n  }\n}\n\nexport async function startAsync(projectRoot: string, options: StartOptions) {\n  const { stdin } = process;\n  const startWaitingForCommand = () => {\n    if (!stdin.setRawMode) {\n      Log.warn(\n        'Non-interactive terminal, keyboard commands are disabled. Please upgrade to Node 12+'\n      );\n      return;\n    }\n    stdin.setRawMode(true);\n    stdin.resume();\n    stdin.setEncoding('utf8');\n    stdin.on('data', handleKeypress);\n  };\n\n  const stopWaitingForCommand = () => {\n    stdin.removeListener('data', handleKeypress);\n    if (!stdin.setRawMode) {\n      Log.warn(\n        'Non-interactive terminal, keyboard commands are disabled. Please upgrade to Node 12+'\n      );\n      return;\n    }\n    stdin.setRawMode(false);\n    stdin.resume();\n  };\n\n  startWaitingForCommand();\n\n  Prompts.addInteractionListener(({ pause }) => {\n    if (pause) {\n      stopWaitingForCommand();\n    } else {\n      startWaitingForCommand();\n    }\n  });\n\n  UserManager.setInteractiveAuthenticationCallback(async () => {\n    stopWaitingForCommand();\n    try {\n      return await loginOrRegisterIfLoggedOutAsync();\n    } finally {\n      startWaitingForCommand();\n    }\n  });\n\n  await printServerInfo(projectRoot, options);\n\n  async function handleKeypress(key: string) {\n    try {\n      await handleKeypressAsync(key);\n    } catch (err: any) {\n      await handleErrorsAsync(err, {});\n      process.exit(1);\n    }\n  }\n\n  async function handleKeypressAsync(key: string) {\n    const shouldPrompt = !options.nonInteractive && ['I', 'A'].includes(key);\n    if (shouldPrompt) {\n      Log.clear();\n    }\n    const { platforms = ['ios', 'android', 'web'] } = options;\n\n    switch (key) {\n      case 'A':\n      case 'a':\n        if (options.webOnly) {\n          Log.log(`${BLT} Opening the web project in Chrome on Android...`);\n          const results = await Android.openWebProjectAsync({\n            projectRoot,\n            shouldPrompt,\n          });\n          if (!results.success) {\n            Log.nestedError(results.error);\n          }\n        } else {\n          const isDisabled = !platforms.includes('android');\n          if (isDisabled) {\n            Log.nestedWarn(\n              `Android is disabled, enable it by adding ${chalk.bold`android`} to the platforms array in your app.json or app.config.js`\n            );\n            break;\n          }\n\n          Log.log(`${BLT} Opening on Android...`);\n          const results = await Android.openProjectAsync({\n            projectRoot,\n            shouldPrompt,\n            devClient: options.devClient ?? false,\n          });\n          if (!results.success && results.error !== 'escaped') {\n            Log.nestedError(\n              typeof results.error === 'string' ? results.error : results.error.message\n            );\n          }\n        }\n        printHelp();\n        break;\n      case 'I':\n      case 'i':\n        if (options.webOnly) {\n          Log.log(`${BLT} Opening the web project in Safari on iOS...`);\n          const results = await Simulator.openWebProjectAsync({\n            projectRoot,\n            shouldPrompt,\n          });\n          if (!results.success) {\n            Log.nestedError(results.error);\n          }\n        } else {\n          const isDisabled = !platforms.includes('ios');\n          if (isDisabled) {\n            Log.nestedWarn(\n              `iOS is disabled, enable it by adding ${chalk.bold`ios`} to the platforms array in your app.json or app.config.js`\n            );\n            break;\n          }\n          Log.log(`${BLT} Opening on iOS...`);\n          const results = await Simulator.openProjectAsync({\n            projectRoot,\n            shouldPrompt,\n            devClient: options.devClient ?? false,\n          });\n          if (!results.success && results.error !== 'escaped') {\n            Log.nestedError(results.error);\n          }\n        }\n        printHelp();\n        break;\n    }\n\n    switch (key) {\n      case CTRL_C:\n      case CTRL_D: {\n        // @ts-ignore: Argument of type '\"SIGINT\"' is not assignable to parameter of type '\"disconnect\"'.\n        process.emit('SIGINT');\n        // Prevent terminal UI from accepting commands while the process is closing.\n        // Without this, fast typers will close the server then start typing their\n        // next command and have a bunch of unrelated things pop up.\n        Prompts.pauseInteractions();\n        break;\n      }\n      case CTRL_L: {\n        Log.clear();\n        break;\n      }\n      case '?': {\n        await printUsageAsync(projectRoot, options);\n        break;\n      }\n      case 'w': {\n        try {\n          if (await ensureWebSupportSetupAsync(projectRoot)) {\n            if (!platforms.includes('web')) {\n              platforms.push('web');\n              options.platforms?.push('web');\n            }\n          }\n        } catch (e: any) {\n          Log.nestedWarn(e.message);\n          break;\n        }\n\n        const isDisabled = !platforms.includes('web');\n        if (isDisabled) {\n          // Use warnings from the web support setup.\n          break;\n        }\n\n        // Ensure the Webpack dev server is running first\n        const isStarted = await Webpack.getUrlAsync(projectRoot);\n\n        if (!isStarted) {\n          await Project.startAsync(projectRoot, { webOnly: true });\n          // When this is the first time webpack is started, reprint the connection info.\n          await printServerInfo(projectRoot, options);\n        }\n\n        Log.log(`${BLT} Open in the web browser...`);\n        await Webpack.openAsync(projectRoot);\n        printHelp();\n        break;\n      }\n      case 'c': {\n        Log.clear();\n        await printServerInfo(projectRoot, options);\n        break;\n      }\n      case 'D':\n      case 'd': {\n        Log.warn(\n          `\\n${BLT} Dev Tools Web UI has been removed. ${learnMore(\n            'https://blog.expo.dev/sunsetting-the-web-ui-for-expo-cli-ab12936d2206'\n          )}`\n        );\n        break;\n      }\n      case 'j': {\n        await openJsInsectorAsync(projectRoot);\n        break;\n      }\n      case 'm': {\n        if (options.isWebSocketsEnabled) {\n          Log.log(`${BLT} Toggling dev menu`);\n          Project.broadcastMessage('devMenu');\n          Webpack.broadcastMessage('devMenu');\n        }\n        break;\n      }\n      case 'M': {\n        if (options.isWebSocketsEnabled) {\n          Prompts.pauseInteractions();\n          try {\n            const value = await selectAsync({\n              // Options match: Chrome > View > Developer\n              message: `Dev tools ${chalk.dim`(native only)`}`,\n              choices: [\n                { title: 'Inspect elements', value: 'toggleElementInspector' },\n                { title: 'Toggle performance monitor', value: 'togglePerformanceMonitor' },\n                { title: 'Toggle developer menu', value: 'toggleDevMenu' },\n                { title: 'Reload app', value: 'reload' },\n                // TODO: Maybe a \"View Source\" option to open code.\n                // Toggling Remote JS Debugging is pretty rough, so leaving it disabled.\n                // { title: 'Toggle Remote Debugging', value: 'toggleRemoteDebugging' },\n              ],\n            });\n            Project.broadcastMessage('sendDevCommand', { name: value });\n            Webpack.broadcastMessage('sendDevCommand', { name: value });\n          } catch {\n            // do nothing\n          } finally {\n            Prompts.resumeInteractions();\n            printHelp();\n          }\n        }\n        break;\n      }\n      case 'p': {\n        Log.clear();\n        const projectSettings = await ProjectSettings.readAsync(projectRoot);\n        const dev = !projectSettings.dev;\n        await ProjectSettings.setAsync(projectRoot, { dev, minify: !dev });\n        Log.log(\n          `Metro bundler is now running in ${chalk.bold(\n            dev ? 'development' : 'production'\n          )}${chalk.reset(` mode.`)}\nPlease reload the project in Expo Go for the change to take effect.`\n        );\n        printHelp();\n        break;\n      }\n      case 'r':\n        if (options.isRemoteReloadingEnabled) {\n          Log.log(`${BLT} Reloading apps`);\n          // Send reload requests over the dev servers\n          Project.broadcastMessage('reload');\n\n          Webpack.broadcastMessage('reload');\n        } else if (!options.webOnly) {\n          // [SDK 40]: Restart bundler\n          Log.clear();\n          Project.startAsync(projectRoot, { ...options, reset: false });\n          Log.log('Restarting Metro bundler...');\n        }\n        break;\n      case 'R':\n        if (!options.isRemoteReloadingEnabled) {\n          // [SDK 40]: Restart bundler with cache\n          Log.clear();\n          Project.startAsync(projectRoot, { ...options, reset: true });\n          Log.log('Restarting Metro bundler and clearing cache...');\n        }\n        break;\n      case 'o':\n        Log.log(`${BLT} Opening the editor...`);\n        await openInEditorAsync(projectRoot, { editor: process.env.EXPO_EDITOR });\n    }\n  }\n}\n"],"mappings":"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"}