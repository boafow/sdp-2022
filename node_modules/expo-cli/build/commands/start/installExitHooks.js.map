{"version":3,"file":"installExitHooks.js","names":["installExitHooks","projectRoot","killSignals","signal","process","on","currentSpinner","Log","getSpinner","fail","setSpinner","currentProgress","getProgress","terminate","setBundleProgressBar","spinner","ora","text","color","start","Project","stopAsync","then","stopAndPersist","symbol","exit","catch","error","installCustomExitHook","listener"],"sources":["../../../src/commands/start/installExitHooks.ts"],"sourcesContent":["import { Project } from 'xdl';\n\nimport Log from '../../log';\nimport { ora } from '../../utils/ora';\n\nexport function installExitHooks(projectRoot: string): void {\n  const killSignals: ['SIGINT', 'SIGTERM'] = ['SIGINT', 'SIGTERM'];\n  for (const signal of killSignals) {\n    process.on(signal, () => {\n      const currentSpinner = Log.getSpinner();\n      if (currentSpinner) {\n        currentSpinner.fail();\n        Log.setSpinner(null);\n      }\n      const currentProgress = Log.getProgress();\n      if (currentProgress) {\n        currentProgress.terminate();\n        Log.setBundleProgressBar(null);\n      }\n      const spinner = ora({ text: 'Stopping server', color: 'white' }).start();\n      Log.setSpinner(spinner);\n      Project.stopAsync(projectRoot)\n        .then(() => {\n          spinner.stopAndPersist({ text: 'Stopped server', symbol: `\\u203A` });\n          process.exit();\n        })\n        .catch(error => {\n          spinner.fail('Failed to stop server');\n          Log.error(error);\n        });\n    });\n  }\n}\n\nexport function installCustomExitHook(listener: NodeJS.SignalsListener) {\n  const killSignals: ['SIGINT', 'SIGTERM'] = ['SIGINT', 'SIGTERM'];\n  for (const signal of killSignals) {\n    process.on(signal, listener);\n  }\n}\n"],"mappings":";;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAsC;AAE/B,SAASA,gBAAgB,CAACC,WAAmB,EAAQ;EAC1D,MAAMC,WAAkC,GAAG,CAAC,QAAQ,EAAE,SAAS,CAAC;EAChE,KAAK,MAAMC,MAAM,IAAID,WAAW,EAAE;IAChCE,OAAO,CAACC,EAAE,CAACF,MAAM,EAAE,MAAM;MACvB,MAAMG,cAAc,GAAGC,cAAG,CAACC,UAAU,EAAE;MACvC,IAAIF,cAAc,EAAE;QAClBA,cAAc,CAACG,IAAI,EAAE;QACrBF,cAAG,CAACG,UAAU,CAAC,IAAI,CAAC;MACtB;MACA,MAAMC,eAAe,GAAGJ,cAAG,CAACK,WAAW,EAAE;MACzC,IAAID,eAAe,EAAE;QACnBA,eAAe,CAACE,SAAS,EAAE;QAC3BN,cAAG,CAACO,oBAAoB,CAAC,IAAI,CAAC;MAChC;MACA,MAAMC,OAAO,GAAG,IAAAC,UAAG,EAAC;QAAEC,IAAI,EAAE,iBAAiB;QAAEC,KAAK,EAAE;MAAQ,CAAC,CAAC,CAACC,KAAK,EAAE;MACxEZ,cAAG,CAACG,UAAU,CAACK,OAAO,CAAC;MACvBK,cAAO,CAACC,SAAS,CAACpB,WAAW,CAAC,CAC3BqB,IAAI,CAAC,MAAM;QACVP,OAAO,CAACQ,cAAc,CAAC;UAAEN,IAAI,EAAE,gBAAgB;UAAEO,MAAM,EAAG;QAAQ,CAAC,CAAC;QACpEpB,OAAO,CAACqB,IAAI,EAAE;MAChB,CAAC,CAAC,CACDC,KAAK,CAACC,KAAK,IAAI;QACdZ,OAAO,CAACN,IAAI,CAAC,uBAAuB,CAAC;QACrCF,cAAG,CAACoB,KAAK,CAACA,KAAK,CAAC;MAClB,CAAC,CAAC;IACN,CAAC,CAAC;EACJ;AACF;AAEO,SAASC,qBAAqB,CAACC,QAAgC,EAAE;EACtE,MAAM3B,WAAkC,GAAG,CAAC,QAAQ,EAAE,SAAS,CAAC;EAChE,KAAK,MAAMC,MAAM,IAAID,WAAW,EAAE;IAChCE,OAAO,CAACC,EAAE,CAACF,MAAM,EAAE0B,QAAQ,CAAC;EAC9B;AACF"}