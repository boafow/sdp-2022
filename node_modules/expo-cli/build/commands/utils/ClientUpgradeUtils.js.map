{"version":3,"file":"ClientUpgradeUtils.js","names":["getExpoSdkConfig","path","projectRoot","findProjectRootAsync","exp","getConfig","skipSDKVersionRequirement","error","code","undefined","getClient","platform","sdk","androidClientUrl","url","version","androidClientVersion","iosClientUrl","iosClientVersion","getAvailableClients","options","Object","keys","sdkVersions","reverse","map","client","sdkVersionString","sdkVersion","clientUrl","clientVersion","filter","hasUrl","isDeprecated","IsCompatible","project","Versions","lteSdkVersion","askClientToInstall","answer","prompt","type","name","message","optionsPerPage","choices","clients","clientLabels","latestSdkVersion","currentSdkVersion","Boolean","clientMessage","length","join","value","title","chalk","bold","gray","targetClient"],"sources":["../../../src/commands/utils/ClientUpgradeUtils.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport { ExpoConfig } from '@expo/config-types';\nimport chalk from 'chalk';\nimport { Versions } from 'xdl';\n\nimport prompt from '../../utils/prompts';\nimport { findProjectRootAsync } from './ProjectUtils';\n\nexport async function getExpoSdkConfig(path: string) {\n  try {\n    const { projectRoot } = await findProjectRootAsync(path);\n    const { exp } = getConfig(projectRoot, {\n      skipSDKVersionRequirement: true,\n    });\n    return exp;\n  } catch (error: any) {\n    if (error.code !== 'NO_PROJECT') {\n      throw error;\n    }\n  }\n  return undefined;\n}\n\ntype ClientPlatform = 'android' | 'ios';\n\nexport function getClient(platform: ClientPlatform, sdk?: Versions.SDKVersion | null) {\n  if (!sdk) {\n    return null;\n  }\n\n  if (platform === 'android' && sdk.androidClientUrl) {\n    return {\n      url: sdk.androidClientUrl,\n      version: sdk.androidClientVersion,\n    };\n  }\n\n  if (platform === 'ios' && sdk.iosClientUrl) {\n    return {\n      url: sdk.iosClientUrl,\n      version: sdk.iosClientVersion,\n    };\n  }\n\n  return null;\n}\n\ninterface AvailableClientOptions {\n  sdkVersions: Versions.SDKVersions;\n  platform: ClientPlatform;\n  project?: ExpoConfig;\n}\n\ninterface AvailableClient {\n  sdkVersion: Versions.SDKVersion;\n  sdkVersionString: string;\n  clientUrl?: string;\n  clientVersion?: string;\n}\n\nexport function getAvailableClients(options: AvailableClientOptions): AvailableClient[] {\n  return Object.keys(options.sdkVersions)\n    .reverse()\n    .map(version => {\n      const client = getClient(options.platform, options.sdkVersions[version]);\n\n      return {\n        sdkVersionString: version,\n        sdkVersion: options.sdkVersions[version],\n        clientUrl: client?.url,\n        clientVersion: client?.version,\n      };\n    })\n    .filter(client => {\n      const hasUrl = !!client.clientUrl;\n      const isDeprecated = !!client.sdkVersion.isDeprecated;\n      const IsCompatible = options.project\n        ? Versions.lteSdkVersion(options.project, client.sdkVersionString)\n        : true;\n\n      return !isDeprecated && IsCompatible && hasUrl;\n    });\n}\n\ninterface InstallClientOptions {\n  clients: AvailableClient[];\n  latestSdkVersion?: string;\n  currentSdkVersion?: string;\n}\n\nexport async function askClientToInstall(options: InstallClientOptions): Promise<AvailableClient> {\n  const answer = await prompt({\n    type: 'select',\n    name: 'targetClient',\n    message: 'Choose an SDK version to install the client for:',\n    optionsPerPage: 20,\n    choices: options.clients.map(client => {\n      const clientVersion = `- client ${client.clientVersion || 'version unknown'}`;\n      const clientLabels = [\n        client.sdkVersionString === options.latestSdkVersion && 'latest',\n        client.sdkVersionString === options.currentSdkVersion && 'recommended',\n      ].filter(Boolean);\n\n      const clientMessage = clientLabels.length\n        ? `${clientVersion} (${clientLabels.join(', ')})`\n        : clientVersion;\n\n      return {\n        value: client,\n        title: `${chalk.bold(client.sdkVersionString)} ${chalk.gray(clientMessage)}`,\n      };\n    }),\n  });\n\n  return answer.targetClient;\n}\n"],"mappings":"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"}