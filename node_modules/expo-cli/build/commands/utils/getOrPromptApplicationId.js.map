{"version":3,"file":"getOrPromptApplicationId.js","names":["noBundleIdMessage","noPackageMessage","getOrPromptForBundleIdentifier","projectRoot","exp","getConfig","skipSDKVersionRequirement","currentBundleId","ios","bundleIdentifier","validateBundleId","CommandError","recommendedBundleId","android","package","username","owner","UserManager","getCurrentUsernameAsync","possibleId","slug","Log","addNewLineIfNone","log","chalk","bold","dim","learnMore","newLine","prompt","type","name","initial","message","validate","nonInteractiveHelp","warning","getBundleIdWarningAsync","nestedWarn","confirmAsync","attemptModification","getOrPromptForPackage","currentPackage","validatePackage","recommendedPackage","split","join","packageName","getPackageNameWarningAsync"],"sources":["../../../src/commands/utils/getOrPromptApplicationId.ts"],"sourcesContent":["import { getConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport { UserManager } from 'xdl';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport prompt, { confirmAsync } from '../../utils/prompts';\nimport { learnMore } from './TerminalLink';\nimport { attemptModification } from './modifyConfigAsync';\nimport {\n  getBundleIdWarningAsync,\n  getPackageNameWarningAsync,\n  validateBundleId,\n  validatePackage,\n} from './validateApplicationId';\n\nconst noBundleIdMessage = `Your project must have a \\`bundleIdentifier\\` set in the Expo config (app.json or app.config.js).\\nSee https://expo.fyi/bundle-identifier`;\nconst noPackageMessage = `Your project must have a \\`package\\` set in the Expo config (app.json or app.config.js).\\nSee https://expo.fyi/android-package`;\n\nexport async function getOrPromptForBundleIdentifier(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n\n  const currentBundleId = exp.ios?.bundleIdentifier;\n  if (currentBundleId) {\n    if (validateBundleId(currentBundleId)) {\n      return currentBundleId;\n    }\n    throw new CommandError(\n      `The ios.bundleIdentifier defined in your Expo config is not formatted properly. Only alphanumeric characters, '.', '-', and '_' are allowed, and each '.' must be followed by a letter.`\n    );\n  }\n\n  // Recommend a bundle ID based on the username and project slug.\n  let recommendedBundleId: string | undefined;\n  // Attempt to use the android package name first since it's convenient to have them aligned.\n  if (exp.android?.package && validateBundleId(exp.android?.package)) {\n    recommendedBundleId = exp.android?.package;\n  } else {\n    const username = exp.owner ?? (await UserManager.getCurrentUsernameAsync());\n    const possibleId = `com.${username}.${exp.slug}`;\n    if (username && validateBundleId(possibleId)) {\n      recommendedBundleId = possibleId;\n    }\n  }\n\n  Log.addNewLineIfNone();\n  Log.log(\n    `${chalk.bold(`üìù  iOS Bundle Identifier`)} ${chalk.dim(\n      learnMore('https://expo.fyi/bundle-identifier')\n    )}`\n  );\n  Log.newLine();\n  // Prompt the user for the bundle ID.\n  // Even if the project is using a dynamic config we can still\n  // prompt a better error message, recommend a default value, and help the user\n  // validate their custom bundle ID upfront.\n  const { bundleIdentifier } = await prompt(\n    {\n      type: 'text',\n      name: 'bundleIdentifier',\n      initial: recommendedBundleId,\n      // The Apple helps people know this isn't an EAS feature.\n      message: `What would you like your iOS bundle identifier to be?`,\n      validate: validateBundleId,\n    },\n    {\n      nonInteractiveHelp: noBundleIdMessage,\n    }\n  );\n\n  // Warn the user if the bundle ID is already in use.\n  const warning = await getBundleIdWarningAsync(bundleIdentifier);\n  if (warning) {\n    Log.newLine();\n    Log.nestedWarn(warning);\n    Log.newLine();\n    if (\n      !(await confirmAsync({\n        message: `Continue?`,\n        initial: true,\n      }))\n    ) {\n      Log.newLine();\n      return getOrPromptForBundleIdentifier(projectRoot);\n    }\n  }\n\n  // Apply the changes to the config.\n  await attemptModification(\n    projectRoot,\n    {\n      ios: { ...(exp.ios || {}), bundleIdentifier },\n    },\n    { ios: { bundleIdentifier } }\n  );\n\n  return bundleIdentifier;\n}\n\nexport async function getOrPromptForPackage(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n\n  const currentPackage = exp.android?.package;\n  if (currentPackage) {\n    if (validatePackage(currentPackage)) {\n      return currentPackage;\n    }\n    throw new CommandError(\n      `Invalid format of Android package name. Only alphanumeric characters, '.' and '_' are allowed, and each '.' must be followed by a letter.`\n    );\n  }\n\n  // Recommend a package name based on the username and project slug.\n  let recommendedPackage: string | undefined;\n  // Attempt to use the ios bundle id first since it's convenient to have them aligned.\n  if (exp.ios?.bundleIdentifier && validatePackage(exp.ios.bundleIdentifier)) {\n    recommendedPackage = exp.ios.bundleIdentifier;\n  } else {\n    const username = exp.owner ?? (await UserManager.getCurrentUsernameAsync());\n    // It's common to use dashes in your node project name, strip them from the suggested package name.\n    const possibleId = `com.${username}.${exp.slug}`.split('-').join('');\n    if (username && validatePackage(possibleId)) {\n      recommendedPackage = possibleId;\n    }\n  }\n\n  Log.addNewLineIfNone();\n  Log.log(\n    `${chalk.bold(`üìù  Android package`)} ${chalk.dim(\n      learnMore('https://expo.fyi/android-package')\n    )}`\n  );\n  Log.newLine();\n\n  // Prompt the user for the android package.\n  // Even if the project is using a dynamic config we can still\n  // prompt a better error message, recommend a default value, and help the user\n  // validate their custom android package upfront.\n  const { packageName } = await prompt(\n    {\n      type: 'text',\n      name: 'packageName',\n      initial: recommendedPackage,\n      message: `What would you like your Android package name to be?`,\n      validate: validatePackage,\n    },\n    {\n      nonInteractiveHelp: noPackageMessage,\n    }\n  );\n\n  // Warn the user if the package name is already in use.\n  const warning = await getPackageNameWarningAsync(packageName);\n  if (warning) {\n    Log.newLine();\n    Log.nestedWarn(warning);\n    Log.newLine();\n    if (\n      !(await confirmAsync({\n        message: `Continue?`,\n        initial: true,\n      }))\n    ) {\n      Log.newLine();\n      return getOrPromptForPackage(projectRoot);\n    }\n  }\n\n  // Apply the changes to the config.\n  await attemptModification(\n    projectRoot,\n    {\n      android: { ...(exp.android || {}), package: packageName },\n    },\n    {\n      android: { package: packageName },\n    }\n  );\n\n  return packageName;\n}\n"],"mappings":"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"}