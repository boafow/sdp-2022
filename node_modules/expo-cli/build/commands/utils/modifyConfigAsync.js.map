{"version":3,"file":"modifyConfigAsync.js","names":["attemptModification","projectRoot","edits","exactEdits","modification","modifyConfigAsync","skipSDKVersionRequirement","type","Log","addNewLineIfNone","warnAboutConfigAndThrow","message","logNoConfig","log","chalk","yellow","bold","attemptAddingPluginsAsync","exp","plugins","length","Set","concat","skipPlugins","join","notifyAboutManualConfigEdits","SilentError","cyan","newLine","JSON","stringify"],"sources":["../../../src/commands/utils/modifyConfigAsync.ts"],"sourcesContent":["import { ExpoConfig, modifyConfigAsync } from '@expo/config';\nimport chalk from 'chalk';\n\nimport { SilentError } from '../../CommandError';\nimport Log from '../../log';\n\nexport async function attemptModification(\n  projectRoot: string,\n  edits: Partial<ExpoConfig>,\n  exactEdits: Partial<ExpoConfig>\n): Promise<void> {\n  const modification = await modifyConfigAsync(projectRoot, edits, {\n    skipSDKVersionRequirement: true,\n  });\n  if (modification.type === 'success') {\n    Log.addNewLineIfNone();\n  } else {\n    warnAboutConfigAndThrow(modification.type, modification.message!, exactEdits);\n  }\n}\n\nfunction logNoConfig() {\n  Log.log(\n    chalk.yellow(\n      `No Expo config was found. Please create an Expo config (${chalk.bold`app.json`} or ${chalk.bold`app.config.js`}) in your project root.`\n    )\n  );\n}\n\nexport async function attemptAddingPluginsAsync(\n  projectRoot: string,\n  exp: Pick<ExpoConfig, 'plugins'>,\n  plugins: string[]\n): Promise<void> {\n  if (!plugins.length) return;\n\n  const edits = {\n    plugins: [...new Set((exp.plugins || []).concat(plugins))],\n  };\n  const modification = await modifyConfigAsync(projectRoot, edits, {\n    skipSDKVersionRequirement: true,\n    skipPlugins: true,\n  });\n  if (modification.type === 'success') {\n    Log.log(`\\u203A Added config plugin${plugins.length === 1 ? '' : 's'}: ${plugins.join(', ')}`);\n  } else {\n    const exactEdits = {\n      plugins,\n    };\n    warnAboutConfigAndThrow(modification.type, modification.message!, exactEdits);\n  }\n}\n\nexport function warnAboutConfigAndThrow(type: string, message: string, edits: Partial<ExpoConfig>) {\n  Log.addNewLineIfNone();\n  if (type === 'warn') {\n    // The project is using a dynamic config, give the user a helpful log and bail out.\n    Log.log(chalk.yellow(message));\n  } else {\n    logNoConfig();\n  }\n\n  notifyAboutManualConfigEdits(edits);\n  throw new SilentError();\n}\n\nfunction notifyAboutManualConfigEdits(edits: Partial<ExpoConfig>) {\n  Log.log(chalk.cyan(`Please add the following to your Expo config`));\n  Log.newLine();\n  Log.log(JSON.stringify(edits, null, 2));\n  Log.newLine();\n}\n"],"mappings":";;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA4B;AAErB,eAAeA,mBAAmB,CACvCC,WAAmB,EACnBC,KAA0B,EAC1BC,UAA+B,EAChB;EACf,MAAMC,YAAY,GAAG,MAAM,IAAAC,2BAAiB,EAACJ,WAAW,EAAEC,KAAK,EAAE;IAC/DI,yBAAyB,EAAE;EAC7B,CAAC,CAAC;EACF,IAAIF,YAAY,CAACG,IAAI,KAAK,SAAS,EAAE;IACnCC,cAAG,CAACC,gBAAgB,EAAE;EACxB,CAAC,MAAM;IACLC,uBAAuB,CAACN,YAAY,CAACG,IAAI,EAAEH,YAAY,CAACO,OAAO,EAAGR,UAAU,CAAC;EAC/E;AACF;AAEA,SAASS,WAAW,GAAG;EACrBJ,cAAG,CAACK,GAAG,CACLC,gBAAK,CAACC,MAAM,CACT,2DAA0DD,gBAAK,CAACE,IAAK,UAAU,OAAMF,gBAAK,CAACE,IAAK,eAAe,yBAAwB,CACzI,CACF;AACH;AAEO,eAAeC,yBAAyB,CAC7ChB,WAAmB,EACnBiB,GAAgC,EAChCC,OAAiB,EACF;EACf,IAAI,CAACA,OAAO,CAACC,MAAM,EAAE;EAErB,MAAMlB,KAAK,GAAG;IACZiB,OAAO,EAAE,CAAC,GAAG,IAAIE,GAAG,CAAC,CAACH,GAAG,CAACC,OAAO,IAAI,EAAE,EAAEG,MAAM,CAACH,OAAO,CAAC,CAAC;EAC3D,CAAC;EACD,MAAMf,YAAY,GAAG,MAAM,IAAAC,2BAAiB,EAACJ,WAAW,EAAEC,KAAK,EAAE;IAC/DI,yBAAyB,EAAE,IAAI;IAC/BiB,WAAW,EAAE;EACf,CAAC,CAAC;EACF,IAAInB,YAAY,CAACG,IAAI,KAAK,SAAS,EAAE;IACnCC,cAAG,CAACK,GAAG,CAAE,6BAA4BM,OAAO,CAACC,MAAM,KAAK,CAAC,GAAG,EAAE,GAAG,GAAI,KAAID,OAAO,CAACK,IAAI,CAAC,IAAI,CAAE,EAAC,CAAC;EAChG,CAAC,MAAM;IACL,MAAMrB,UAAU,GAAG;MACjBgB;IACF,CAAC;IACDT,uBAAuB,CAACN,YAAY,CAACG,IAAI,EAAEH,YAAY,CAACO,OAAO,EAAGR,UAAU,CAAC;EAC/E;AACF;AAEO,SAASO,uBAAuB,CAACH,IAAY,EAAEI,OAAe,EAAET,KAA0B,EAAE;EACjGM,cAAG,CAACC,gBAAgB,EAAE;EACtB,IAAIF,IAAI,KAAK,MAAM,EAAE;IACnB;IACAC,cAAG,CAACK,GAAG,CAACC,gBAAK,CAACC,MAAM,CAACJ,OAAO,CAAC,CAAC;EAChC,CAAC,MAAM;IACLC,WAAW,EAAE;EACf;EAEAa,4BAA4B,CAACvB,KAAK,CAAC;EACnC,MAAM,KAAIwB,2BAAW,GAAE;AACzB;AAEA,SAASD,4BAA4B,CAACvB,KAA0B,EAAE;EAChEM,cAAG,CAACK,GAAG,CAACC,gBAAK,CAACa,IAAI,CAAE,8CAA6C,CAAC,CAAC;EACnEnB,cAAG,CAACoB,OAAO,EAAE;EACbpB,cAAG,CAACK,GAAG,CAACgB,IAAI,CAACC,SAAS,CAAC5B,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;EACvCM,cAAG,CAACoB,OAAO,EAAE;AACf"}