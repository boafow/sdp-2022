{"version":3,"file":"updateTSConfig.js","names":["TS_FEATURE_FLAG","isTypeScriptSetupDisabled","boolish","updateTSConfigAsync","projectRoot","tsConfigPath","isBootstrapping","JsonFile","writeAsync","projectTSConfig","read","json5","compilerOptions","modifications","hasTemplateTsconfig","resolveBaseTSConfig","extends","baseTSConfigName","push","jsx","target","lib","allowJs","skipLibCheck","noEmit","allowSyntheticDefaultImports","resolveJsonModule","esModuleInterop","moduleResolution","length","Log","addNewLineIfNone","log","chalk","bold","cyan","dim","logModifications","newLine","printTable","sort","a","b","items","tableFormat","name","msg","key","value"],"sources":["../../../../src/commands/utils/typescript/updateTSConfig.ts"],"sourcesContent":["import JsonFile from '@expo/json-file';\nimport chalk from 'chalk';\nimport { boolish } from 'getenv';\n\nimport Log from '../../../log';\nimport { baseTSConfigName, resolveBaseTSConfig } from './resolveModules';\n\nconst TS_FEATURE_FLAG = 'EXPO_NO_TYPESCRIPT_SETUP';\n\nexport const isTypeScriptSetupDisabled = boolish(TS_FEATURE_FLAG, false);\n\nexport async function updateTSConfigAsync({\n  projectRoot,\n  tsConfigPath,\n  isBootstrapping,\n}: {\n  projectRoot: string;\n  tsConfigPath: string;\n  isBootstrapping: boolean;\n}): Promise<void> {\n  if (isBootstrapping) {\n    await JsonFile.writeAsync(tsConfigPath, {});\n  }\n\n  const projectTSConfig = JsonFile.read(tsConfigPath, {\n    // Some tsconfig.json files have a generated comment in the file.\n    json5: true,\n  });\n  if (projectTSConfig.compilerOptions == null) {\n    projectTSConfig.compilerOptions = {};\n    isBootstrapping = true;\n  }\n\n  const modifications: [string, string][] = [];\n\n  // If the default TSConfig template exists (SDK +41), then use it in the project\n  const hasTemplateTsconfig = resolveBaseTSConfig(projectRoot);\n  if (hasTemplateTsconfig) {\n    // If the extends field isn't defined, set it to the expo default\n    if (!projectTSConfig.extends) {\n      // if (projectTSConfig.extends !== baseTSConfigName) {\n      projectTSConfig.extends = baseTSConfigName;\n      modifications.push(['extends', baseTSConfigName]);\n    }\n  } else if (isBootstrapping) {\n    // use an unversioned config when the versioned config cannot be resolved\n    projectTSConfig.compilerOptions = {\n      jsx: 'react-native',\n      target: 'esnext',\n      lib: ['esnext'],\n      allowJs: true,\n      skipLibCheck: true,\n      noEmit: true,\n      allowSyntheticDefaultImports: true,\n      resolveJsonModule: true,\n      esModuleInterop: true,\n      moduleResolution: 'node',\n    };\n    modifications.push(['compilerOptions', 'configured']);\n  }\n\n  // If no changes, then quietly bail out\n  if (!modifications.length) {\n    return;\n  }\n\n  // Write changes and log out a summary of what changed\n  await JsonFile.writeAsync(tsConfigPath, projectTSConfig);\n\n  Log.addNewLineIfNone();\n\n  if (isBootstrapping) {\n    Log.log(`${chalk.bold`TypeScript`}: A ${chalk.cyan('tsconfig.json')} has been auto-generated`);\n  } else {\n    Log.log(\n      `${chalk.bold`TypeScript`}: The ${chalk.cyan(\n        'tsconfig.json'\n      )} has been updated ${chalk.dim`(Use ${TS_FEATURE_FLAG} to skip)`}`\n    );\n    logModifications(modifications);\n  }\n  Log.newLine();\n}\n\nfunction logModifications(modifications: string[][]) {\n  Log.newLine();\n\n  Log.log(\n    `\\u203A ${chalk.bold('Required')} modifications made to the ${chalk.cyan('tsconfig.json')}:`\n  );\n\n  Log.newLine();\n\n  // Sort the items based on key name length\n  printTable(modifications.sort((a, b) => a[0].length - b[0].length));\n\n  Log.newLine();\n}\n\nfunction printTable(items: string[][]) {\n  const tableFormat = (name: string, msg: string) =>\n    `  ${chalk.bold`${name}`} is now ${chalk.cyan(msg)}`;\n  for (const [key, value] of items) {\n    Log.log(tableFormat(key, value));\n  }\n}\n"],"mappings":"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"}