{"version":3,"file":"urlOpts.js","names":["addOptions","program","option","optsAsync","projectRoot","options","opts","ProjectSettings","readAsync","host","lan","localhost","tunnel","filter","i","length","CommandError","hostType","offline","ConnectionStatus","setIsOffline","scheme","devClient","getOptionalDevClientSchemeAsync","isDevClientPackageInstalled","setAsync","printQRCode","url","qrcodeTerminal","generate","small","code","Log","log","handleMobileOptsAsync","results","Promise","all","android","webOnly","Android","openWebProjectAsync","openProjectAsync","ios","Simulator","shouldPrompt","web","Webpack","openAsync","errors","reduce","prev","curr","success","concat","error","Boolean","isEscapedError","some","AbortCommandError"],"sources":["../../../src/commands/utils/urlOpts.ts"],"sourcesContent":["import type { Command } from 'commander';\nimport qrcodeTerminal from 'qrcode-terminal';\nimport {\n  Android,\n  ConnectionStatus,\n  isDevClientPackageInstalled,\n  ProjectSettings,\n  Simulator,\n  Webpack,\n} from 'xdl';\n\nimport CommandError, { AbortCommandError } from '../../CommandError';\nimport Log from '../../log';\nimport { getOptionalDevClientSchemeAsync } from '../run/utils/schemes';\n\n// NOTE: if you update this, you should also update assertValidOptions in UrlUtils.ts\nexport type URLOptions = {\n  devClient?: boolean;\n  android?: boolean;\n  ios?: boolean;\n  web?: boolean;\n  scheme?: string;\n  host?: 'lan' | 'tunnel' | 'localhost';\n  tunnel?: boolean;\n  lan?: boolean;\n  localhost?: boolean;\n};\n\nfunction addOptions(program: Command) {\n  program\n    .option(\n      '--dev-client',\n      'Experimental: Starts the bundler for use with the expo-development-client'\n    )\n    .option('--scheme <scheme>', 'Custom URI protocol to use with a development build')\n    .option('-a, --android', 'Opens your app in Expo Go on a connected Android device')\n    .option(\n      '-i, --ios',\n      'Opens your app in Expo Go in a currently running iOS simulator on your computer'\n    )\n    .option('-w, --web', 'Opens your app in a web browser')\n    .option(\n      '-m, --host [mode]',\n      'lan (default), tunnel, localhost. Type of host to use. \"tunnel\" allows you to view your link on other networks'\n    )\n    .option('--tunnel', 'Same as --host tunnel')\n    .option('--lan', 'Same as --host lan')\n    .option('--localhost', 'Same as --host localhost');\n}\n\nasync function optsAsync(projectRoot: string, options: any) {\n  const opts = await ProjectSettings.readAsync(projectRoot);\n\n  if ([options.host, options.lan, options.localhost, options.tunnel].filter(i => i).length > 1) {\n    throw new CommandError(\n      'BAD_ARGS',\n      'Specify at most one of --host, --tunnel, --lan, and --localhost'\n    );\n  }\n\n  opts.hostType = 'lan';\n\n  if (options.offline) {\n    // TODO: maybe let people know that we will force localhost with offline?\n    ConnectionStatus.setIsOffline(true);\n    opts.hostType = 'localhost';\n  }\n\n  if (options.host) {\n    opts.hostType = options.host;\n  } else if (options.tunnel) {\n    opts.hostType = 'tunnel';\n  } else if (options.lan) {\n    opts.hostType = 'lan';\n  } else if (options.localhost) {\n    opts.hostType = 'localhost';\n  }\n\n  if (typeof options.scheme === 'string') {\n    // Use the custom scheme\n    opts.scheme = options.scheme ?? null;\n  } else if (options.devClient) {\n    // Attempt to find the scheme or warn the user how to setup a custom scheme\n    opts.scheme = await getOptionalDevClientSchemeAsync(projectRoot);\n  } else if (!options.devClient && isDevClientPackageInstalled(projectRoot)) {\n    opts.scheme = await getOptionalDevClientSchemeAsync(projectRoot);\n  } else {\n    // Ensure this is reset when users don't use `--scheme`, `--dev-client` and don't have the `expo-dev-client` package installed.\n    opts.scheme = null;\n  }\n\n  await ProjectSettings.setAsync(projectRoot, opts);\n\n  return opts;\n}\n\nfunction printQRCode(url: string) {\n  qrcodeTerminal.generate(url, { small: true }, code => Log.log(code));\n}\n\nasync function handleMobileOptsAsync(\n  projectRoot: string,\n  options: Pick<URLOptions, 'devClient' | 'ios' | 'android' | 'web'> & { webOnly?: boolean }\n) {\n  const results = await Promise.all([\n    (async () => {\n      if (options.android) {\n        if (options.webOnly) {\n          return await Android.openWebProjectAsync({ projectRoot });\n        } else {\n          return await Android.openProjectAsync({\n            projectRoot,\n            devClient: options.devClient ?? false,\n          });\n        }\n      }\n      return null;\n    })(),\n    (async () => {\n      if (options.ios) {\n        if (options.webOnly) {\n          return await Simulator.openWebProjectAsync({ projectRoot, shouldPrompt: false });\n        } else {\n          return await Simulator.openProjectAsync({\n            projectRoot,\n            devClient: options.devClient ?? false,\n            shouldPrompt: false,\n          });\n        }\n      }\n      return null;\n    })(),\n    (async () => {\n      if (options.web) {\n        return await Webpack.openAsync(projectRoot);\n      }\n      return null;\n    })(),\n  ]);\n\n  const errors = results\n    .reduce<(string | Error)[]>((prev, curr) => {\n      if (curr && !curr.success) {\n        return prev.concat([curr.error]);\n      }\n      return prev;\n    }, [])\n    .filter(Boolean);\n\n  if (errors.length) {\n    // ctrl+c\n    const isEscapedError = errors.some(error => error === 'escaped');\n    if (isEscapedError) {\n      throw new AbortCommandError();\n    } else {\n      if (typeof errors[0] === 'string') {\n        // Throw the first error\n        throw new CommandError(errors[0]);\n      }\n      throw errors[0];\n    }\n  }\n\n  return !!options.android || !!options.ios;\n}\n\nexport default {\n  addOptions,\n  handleMobileOptsAsync,\n  printQRCode,\n  optsAsync,\n};\n"],"mappings":"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"}