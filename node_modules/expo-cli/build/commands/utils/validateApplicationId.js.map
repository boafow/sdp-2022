{"version":3,"file":"validateApplicationId.js","names":["validateBundleId","value","test","validatePackage","cachedBundleIdResults","cachedPackageNameResults","getBundleIdWarningAsync","bundleId","isUrlAvailableAsync","url","response","fetch","json","resultCount","firstApp","results","message","formatInUseWarning","trackName","sellerName","getPackageNameWarningAsync","packageName","status","chalk","bold","dim","learnMore","appName","author","id","italic"],"sources":["../../../src/commands/utils/validateApplicationId.ts"],"sourcesContent":["import chalk from 'chalk';\nimport fetch from 'node-fetch';\n\nimport { learnMore } from './TerminalLink';\nimport { isUrlAvailableAsync } from './url';\n\nexport function validateBundleId(value: string): boolean {\n  return /^[a-zA-Z0-9-.]+$/.test(value);\n}\n\nexport function validatePackage(value: string): boolean {\n  return /^[a-zA-Z][a-zA-Z0-9_]*(\\.[a-zA-Z][a-zA-Z0-9_]*)+$/.test(value);\n}\n\nconst cachedBundleIdResults: Record<string, string> = {};\nconst cachedPackageNameResults: Record<string, string> = {};\n\n/**\n * A quality of life method that provides a warning when the bundle ID is already in use.\n *\n * @param bundleId\n */\nexport async function getBundleIdWarningAsync(bundleId: string): Promise<string | null> {\n  // Prevent fetching for the same ID multiple times.\n  if (cachedBundleIdResults[bundleId]) {\n    return cachedBundleIdResults[bundleId];\n  }\n\n  if (!(await isUrlAvailableAsync('itunes.apple.com'))) {\n    // If no network, simply skip the warnings since they'll just lead to more confusion.\n    return null;\n  }\n\n  const url = `http://itunes.apple.com/lookup?bundleId=${bundleId}`;\n  try {\n    const response = await fetch(url);\n    const json = await response.json();\n    if (json.resultCount > 0) {\n      const firstApp = json.results[0];\n      const message = formatInUseWarning(firstApp.trackName, firstApp.sellerName, bundleId);\n      cachedBundleIdResults[bundleId] = message;\n      return message;\n    }\n  } catch {\n    // Error fetching itunes data.\n  }\n  return null;\n}\n\nexport async function getPackageNameWarningAsync(packageName: string): Promise<string | null> {\n  // Prevent fetching for the same ID multiple times.\n  if (cachedPackageNameResults[packageName]) {\n    return cachedPackageNameResults[packageName];\n  }\n\n  if (!(await isUrlAvailableAsync('play.google.com'))) {\n    // If no network, simply skip the warnings since they'll just lead to more confusion.\n    return null;\n  }\n\n  const url = `https://play.google.com/store/apps/details?id=${packageName}`;\n  try {\n    const response = await fetch(url);\n    // If the page exists, then warn the user.\n    if (response.status === 200) {\n      // There is no JSON API for the Play Store so we can't concisely\n      // locate the app name and developer to match the iOS warning.\n      const message = `⚠️  The package ${chalk.bold(packageName)} is already in use. ${chalk.dim(\n        learnMore(url)\n      )}`;\n      cachedPackageNameResults[packageName] = message;\n      return message;\n    }\n  } catch {\n    // Error fetching play store data or the page doesn't exist.\n  }\n  return null;\n}\n\nfunction formatInUseWarning(appName: string, author: string, id: string): string {\n  return `⚠️  The app ${chalk.bold(appName)} by ${chalk.italic(\n    author\n  )} is already using ${chalk.bold(id)}`;\n}\n"],"mappings":";;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA4C;AAErC,SAASA,gBAAgB,CAACC,KAAa,EAAW;EACvD,OAAO,kBAAkB,CAACC,IAAI,CAACD,KAAK,CAAC;AACvC;AAEO,SAASE,eAAe,CAACF,KAAa,EAAW;EACtD,OAAO,mDAAmD,CAACC,IAAI,CAACD,KAAK,CAAC;AACxE;AAEA,MAAMG,qBAA6C,GAAG,CAAC,CAAC;AACxD,MAAMC,wBAAgD,GAAG,CAAC,CAAC;;AAE3D;AACA;AACA;AACA;AACA;AACO,eAAeC,uBAAuB,CAACC,QAAgB,EAA0B;EACtF;EACA,IAAIH,qBAAqB,CAACG,QAAQ,CAAC,EAAE;IACnC,OAAOH,qBAAqB,CAACG,QAAQ,CAAC;EACxC;EAEA,IAAI,EAAE,MAAM,IAAAC,0BAAmB,EAAC,kBAAkB,CAAC,CAAC,EAAE;IACpD;IACA,OAAO,IAAI;EACb;EAEA,MAAMC,GAAG,GAAI,2CAA0CF,QAAS,EAAC;EACjE,IAAI;IACF,MAAMG,QAAQ,GAAG,MAAM,IAAAC,oBAAK,EAACF,GAAG,CAAC;IACjC,MAAMG,IAAI,GAAG,MAAMF,QAAQ,CAACE,IAAI,EAAE;IAClC,IAAIA,IAAI,CAACC,WAAW,GAAG,CAAC,EAAE;MACxB,MAAMC,QAAQ,GAAGF,IAAI,CAACG,OAAO,CAAC,CAAC,CAAC;MAChC,MAAMC,OAAO,GAAGC,kBAAkB,CAACH,QAAQ,CAACI,SAAS,EAAEJ,QAAQ,CAACK,UAAU,EAAEZ,QAAQ,CAAC;MACrFH,qBAAqB,CAACG,QAAQ,CAAC,GAAGS,OAAO;MACzC,OAAOA,OAAO;IAChB;EACF,CAAC,CAAC,MAAM;IACN;EAAA;EAEF,OAAO,IAAI;AACb;AAEO,eAAeI,0BAA0B,CAACC,WAAmB,EAA0B;EAC5F;EACA,IAAIhB,wBAAwB,CAACgB,WAAW,CAAC,EAAE;IACzC,OAAOhB,wBAAwB,CAACgB,WAAW,CAAC;EAC9C;EAEA,IAAI,EAAE,MAAM,IAAAb,0BAAmB,EAAC,iBAAiB,CAAC,CAAC,EAAE;IACnD;IACA,OAAO,IAAI;EACb;EAEA,MAAMC,GAAG,GAAI,iDAAgDY,WAAY,EAAC;EAC1E,IAAI;IACF,MAAMX,QAAQ,GAAG,MAAM,IAAAC,oBAAK,EAACF,GAAG,CAAC;IACjC;IACA,IAAIC,QAAQ,CAACY,MAAM,KAAK,GAAG,EAAE;MAC3B;MACA;MACA,MAAMN,OAAO,GAAI,mBAAkBO,gBAAK,CAACC,IAAI,CAACH,WAAW,CAAE,uBAAsBE,gBAAK,CAACE,GAAG,CACxF,IAAAC,yBAAS,EAACjB,GAAG,CAAC,CACd,EAAC;MACHJ,wBAAwB,CAACgB,WAAW,CAAC,GAAGL,OAAO;MAC/C,OAAOA,OAAO;IAChB;EACF,CAAC,CAAC,MAAM;IACN;EAAA;EAEF,OAAO,IAAI;AACb;AAEA,SAASC,kBAAkB,CAACU,OAAe,EAAEC,MAAc,EAAEC,EAAU,EAAU;EAC/E,OAAQ,eAAcN,gBAAK,CAACC,IAAI,CAACG,OAAO,CAAE,OAAMJ,gBAAK,CAACO,MAAM,CAC1DF,MAAM,CACN,qBAAoBL,gBAAK,CAACC,IAAI,CAACK,EAAE,CAAE,EAAC;AACxC"}