{"version":3,"file":"IosApiV2Wrapper.js","names":["ApiClient","constructor","api","getAllCredentialsApi","accountName","getAsync","owner","getAllCredentialsForAppApi","projectName","bundleIdentifier","getUserCredentialsByIdApi","id","createDistCertApi","credentials","postAsync","updateDistCertApi","putAsync","deleteDistCertApi","deleteAsync","useDistCertApi","userCredentialsId","experienceName","createPushKeyApi","updatePushKeyApi","deletePushKeyApi","usePushKeyApi","deletePushCertApi","updateProvisioningProfileApi","deleteProvisioningProfileApi"],"sources":["../../../src/credentials/api/IosApiV2Wrapper.ts"],"sourcesContent":["import { ApiV2 } from 'xdl';\n\nimport * as appleApi from '../../appleApi';\nimport { IosAppCredentials, IosDistCredentials, IosPushCredentials } from '../credentials';\n\nexport interface AppLookupParams {\n  accountName: string;\n  projectName: string;\n  bundleIdentifier: string;\n}\n\ninterface IosAllCredentialsForApp extends IosAppCredentials {\n  pushCredentials: Omit<IosPushCredentials, 'id' | 'type'>;\n  distCredentials: Omit<IosDistCredentials, 'id' | 'type'>;\n}\n\ninterface AllCredentialsApiResponse {\n  appCredentials: IosAppCredentials[];\n  userCredentials: (IosDistCredentials | IosPushCredentials)[];\n}\n\n// This class should not be used directly, use only as part of cached api client from ./IosApi.ts\n// or mock it in tests (it's easier to mock this class than ApiV2 directly)\nexport default class ApiClient {\n  constructor(private api: ApiV2) {}\n\n  public async getAllCredentialsApi(accountName: string): Promise<AllCredentialsApiResponse> {\n    return await this.api.getAsync('credentials/ios', { owner: accountName });\n  }\n  public async getAllCredentialsForAppApi({\n    accountName,\n    projectName,\n    bundleIdentifier,\n  }: AppLookupParams): Promise<IosAllCredentialsForApp> {\n    return await this.api.getAsync(\n      `credentials/ios/@${accountName}/${projectName}/${bundleIdentifier}`\n    );\n  }\n\n  public async getUserCredentialsByIdApi(\n    id: number,\n    accountName: string\n  ): Promise<IosDistCredentials | IosPushCredentials> {\n    return await this.api.getAsync(`credentials/ios/userCredentials/${id}`, { owner: accountName });\n  }\n\n  public async createDistCertApi(\n    accountName: string,\n    credentials: appleApi.DistCert\n  ): Promise<number> {\n    const { id } = await this.api.postAsync('credentials/ios/dist', {\n      owner: accountName,\n      credentials,\n    });\n    return id;\n  }\n\n  public async updateDistCertApi(\n    id: number,\n    accountName: string,\n    credentials: appleApi.DistCert\n  ): Promise<void> {\n    await this.api.putAsync(`credentials/ios/dist/${id}`, { credentials, owner: accountName });\n  }\n\n  public async deleteDistCertApi(id: number, accountName: string): Promise<void> {\n    await this.api.deleteAsync(`credentials/ios/dist/${id}`, { owner: accountName });\n  }\n\n  public async useDistCertApi(\n    { accountName, projectName, bundleIdentifier }: AppLookupParams,\n    userCredentialsId: number\n  ): Promise<void> {\n    await this.api.postAsync('credentials/ios/use/dist', {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n      userCredentialsId,\n    });\n  }\n\n  public async createPushKeyApi(\n    accountName: string,\n    credentials: appleApi.PushKey\n  ): Promise<number> {\n    const { id } = await this.api.postAsync('credentials/ios/push', {\n      owner: accountName,\n      credentials,\n    });\n    return id;\n  }\n\n  public async updatePushKeyApi(\n    id: number,\n    accountName: string,\n    credentials: appleApi.PushKey\n  ): Promise<IosPushCredentials> {\n    return await this.api.putAsync(`credentials/ios/push/${id}`, { owner: accountName });\n  }\n\n  public async deletePushKeyApi(id: number, accountName: string): Promise<void> {\n    await this.api.deleteAsync(`credentials/ios/push/${id}`, { owner: accountName });\n  }\n\n  public async usePushKeyApi(\n    { accountName, projectName, bundleIdentifier }: AppLookupParams,\n    userCredentialsId: number\n  ): Promise<void> {\n    await this.api.postAsync('credentials/ios/use/push', {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n      userCredentialsId,\n    });\n  }\n\n  public async deletePushCertApi({\n    accountName,\n    projectName,\n    bundleIdentifier,\n  }: AppLookupParams): Promise<void> {\n    await this.api.postAsync(`credentials/ios/pushCert/delete`, {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n    });\n  }\n\n  public async updateProvisioningProfileApi(\n    { accountName, projectName, bundleIdentifier }: AppLookupParams,\n    credentials: appleApi.ProvisioningProfile\n  ): Promise<void> {\n    await this.api.postAsync(`credentials/ios/provisioningProfile/update`, {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n      credentials,\n    });\n  }\n\n  public async deleteProvisioningProfileApi({\n    accountName,\n    projectName,\n    bundleIdentifier,\n  }: AppLookupParams): Promise<void> {\n    await this.api.postAsync(`credentials/ios/provisioningProfile/delete`, {\n      experienceName: `@${accountName}/${projectName}`,\n      owner: accountName,\n      bundleIdentifier,\n    });\n  }\n}\n"],"mappings":"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"}