{"version":3,"file":"prompts.js","names":["color","require","strikethrough","gray","prompt","questions","nonInteractiveHelp","options","Array","isArray","program","nonInteractive","length","message","question","questionMessage","undefined","trim","replace","CommandError","prompts","onCancel","AbortCommandError","separator","title","disabled","value","autoCompleteAsync","limit","suggest","input","choices","regex","RegExp","filter","choice","test","name","type","selectAsync","onRender","firstRender","cursor","fire","up","next","moveCursor","render","bell","down","i","confirmAsync","initial","toggleConfirmAsync","active","inactive","promptEmailAsync","format","validate"],"sources":["../../src/utils/prompts.ts"],"sourcesContent":["import program from 'commander';\nimport prompts, { Options, PromptObject, PromptType } from 'prompts';\n\nimport CommandError, { AbortCommandError } from '../CommandError';\n\n// NOTE(brentvatne): we don't use strikethrough anywhere in expo-cli currently,\n// and prompts doesn't give us control over disabled styles (1), so until we\n// open a PR to prompts to make it more extensible in this regard we can just\n// have strikethrough make text grey instead through monkey-patching it.\n//\n// (1): https://github.com/terkelg/prompts/blob/972fbb2d43c7b1ee5058800f441daaf51f2c240f/lib/elements/select.js#L152-L154\nconst color = require('kleur');\ncolor.strikethrough = color.gray;\n\nexport type Question<V extends string = string> = PromptObject<V> & {\n  optionsPerPage?: number;\n};\n\nexport { PromptType };\n\ntype PromptOptions = { nonInteractiveHelp?: string } & Options;\n\nexport default function prompt(\n  questions: Question | Question[],\n  { nonInteractiveHelp, ...options }: PromptOptions = {}\n) {\n  questions = Array.isArray(questions) ? questions : [questions];\n  if (program.nonInteractive && questions.length !== 0) {\n    let message = `Input is required, but Expo CLI is in non-interactive mode.\\n`;\n    if (nonInteractiveHelp) {\n      message += nonInteractiveHelp;\n    } else {\n      const question = questions[0];\n      const questionMessage =\n        typeof question.message === 'function'\n          ? question.message(undefined, {}, question)\n          : question.message;\n\n      message += `Required input:\\n${(questionMessage || '').trim().replace(/^/gm, '> ')}`;\n    }\n    throw new CommandError('NON_INTERACTIVE', message);\n  }\n  return prompts(questions, {\n    onCancel() {\n      throw new AbortCommandError();\n    },\n    ...options,\n  });\n}\n\n// todo: replace this workaround, its still selectable by the cursor\n// see: https://github.com/terkelg/prompts/issues/254\nprompt.separator = (title: string) => ({ title, disabled: true, value: undefined });\n\nexport type NamelessQuestion = Omit<Question<'value'>, 'name' | 'type'>;\n\n/**\n * Create an auto complete list that can be searched and cancelled.\n *\n * @param questions\n * @param options\n */\nexport async function autoCompleteAsync(\n  questions: NamelessQuestion | NamelessQuestion[],\n  options?: PromptOptions\n): Promise<string> {\n  const { value } = await prompt(\n    {\n      limit: 11,\n      suggest(input: any, choices: any) {\n        const regex = new RegExp(input, 'i');\n        return choices.filter((choice: any) => regex.test(choice.title));\n      },\n      ...questions,\n      name: 'value',\n      type: 'autocomplete',\n    },\n    options\n  );\n  return value ?? null;\n}\n\n/**\n * Create a selection list that can be cancelled.\n *\n * @param questions\n * @param options\n */\nexport async function selectAsync(\n  questions: NamelessQuestion,\n  options?: PromptOptions\n): Promise<any> {\n  const { value } = await prompt(\n    {\n      limit: 11,\n      ...questions,\n      // @ts-ignore: onRender not in the types\n      onRender(this: {\n        cursor: number;\n        firstRender: boolean;\n        choices: (Omit<prompts.Choice, 'disable'> & { disabled?: boolean })[];\n        value: string;\n        render: () => void;\n        moveCursor: (n: number) => void;\n        fire: () => void;\n        up: () => void;\n        down: () => void;\n        bell: () => void;\n        next: () => void;\n      }) {\n        if (this.firstRender) {\n          // Ensure the initial state isn't on a disabled item.\n          while (this.choices[this.cursor].disabled) {\n            this.cursor++;\n            if (this.cursor > this.choices.length - 1) break;\n          }\n          this.fire();\n          // Without this, the value will be `0` instead of a string.\n          this.value = (this.choices[this.cursor] || {}).value;\n\n          // Support up arrow and `k` key -- no looping\n          this.up = () => {\n            let next = this.cursor;\n            while (true) {\n              if (next <= 0) break;\n              next--;\n              if (!this.choices[next].disabled) break;\n            }\n            if (!this.choices[next].disabled && next !== this.cursor) {\n              this.moveCursor(next);\n              this.render();\n            } else {\n              this.bell();\n            }\n          };\n\n          // Support down arrow and `j` key -- no looping\n          this.down = () => {\n            let next = this.cursor;\n            while (true) {\n              if (next >= this.choices.length - 1) break;\n              next++;\n              if (!this.choices[next].disabled) break;\n            }\n            if (!this.choices[next].disabled && next !== this.cursor) {\n              this.moveCursor(next);\n              this.render();\n            } else {\n              this.bell();\n            }\n          };\n\n          // Support tab -- looping\n          this.next = () => {\n            let next = this.cursor;\n            let i = 0;\n            while (i < this.choices.length) {\n              i++;\n              next = (next + 1) % this.choices.length;\n              if (!this.choices[next].disabled) break;\n            }\n            if (!this.choices[next].disabled) {\n              this.moveCursor(next);\n              this.render();\n            } else {\n              // unexpected\n              this.bell();\n            }\n          };\n        }\n      },\n      name: 'value',\n      type: 'select',\n    },\n    options\n  );\n  return value ?? null;\n}\n\n/**\n * Create a standard yes/no confirmation that can be cancelled.\n *\n * @param questions\n * @param options\n */\nexport async function confirmAsync(\n  questions: NamelessQuestion,\n  options?: PromptOptions\n): Promise<boolean> {\n  const { value } = await prompt(\n    {\n      initial: true,\n      ...questions,\n      name: 'value',\n      type: 'confirm',\n    },\n    options\n  );\n  return value ?? null;\n}\n\n/**\n * Create a more dynamic yes/no confirmation that can be cancelled.\n *\n * @param questions\n * @param options\n */\nexport async function toggleConfirmAsync(\n  questions: NamelessQuestion,\n  options?: PromptOptions\n): Promise<boolean> {\n  const { value } = await prompt(\n    {\n      active: 'yes',\n      inactive: 'no',\n      ...questions,\n      name: 'value',\n      type: 'toggle',\n    },\n    options\n  );\n  return value ?? null;\n}\n\n/**\n * Prompt the user for an email address.\n *\n * @param questions\n * @param options\n */\nexport async function promptEmailAsync(\n  questions: NamelessQuestion,\n  options?: PromptOptions\n): Promise<string> {\n  const { value } = await prompt(\n    {\n      type: 'text',\n      format: value => value.trim(),\n      validate: (value: string) =>\n        /.+@.+/.test(value) ? true : \"That doesn't look like a valid email.\",\n      ...questions,\n      name: 'value',\n    },\n    options\n  );\n  return value.trim();\n}\n"],"mappings":"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"}