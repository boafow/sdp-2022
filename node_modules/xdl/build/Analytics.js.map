{"version":3,"file":"Analytics.js","names":["PLATFORM_TO_ANALYTICS_PLATFORM","darwin","win32","linux","AnalyticsClient","userId","_userId","version","_version","flush","rudderstackClient","initializeClient","rudderstackWriteKey","rudderstackDataPlaneURL","packageVersion","RudderAnalytics","URL","toString","flushInterval","identifyUser","traits","userTraits","identify","context","getContext","logEvent","name","properties","track","event","platform","os","device","model","brand","release","app","defaultClient"],"sources":["../src/Analytics.ts"],"sourcesContent":["import RudderAnalytics from '@expo/rudder-sdk-node';\nimport os from 'os';\nimport { URL } from 'url';\n\nconst PLATFORM_TO_ANALYTICS_PLATFORM: { [platform: string]: string } = {\n  darwin: 'Mac',\n  win32: 'Windows',\n  linux: 'Linux',\n};\n\nexport class AnalyticsClient {\n  private userTraits?: { [key: string]: any };\n  private rudderstackClient?: RudderAnalytics;\n  private _userId?: string;\n  private _version?: string;\n\n  public get userId() {\n    return this._userId;\n  }\n\n  public get version() {\n    return this._version;\n  }\n\n  public async flush() {\n    if (this.rudderstackClient) {\n      await this.rudderstackClient.flush();\n    }\n  }\n\n  public initializeClient(\n    rudderstackWriteKey: string,\n    rudderstackDataPlaneURL: string,\n    packageVersion: string\n  ) {\n    // Do not wait before flushing, we want node to close immediately if the programs ends\n    this.rudderstackClient = new RudderAnalytics(\n      rudderstackWriteKey,\n      new URL('/v1/batch', rudderstackDataPlaneURL).toString(),\n      {\n        flushInterval: 300,\n      }\n    );\n    this._version = packageVersion;\n  }\n\n  public identifyUser(userId: string, traits: { [key: string]: any }) {\n    this._userId = userId;\n    this.userTraits = traits;\n\n    if (this.rudderstackClient) {\n      this.rudderstackClient.identify({\n        userId: this._userId,\n        traits: this.userTraits,\n        context: this.getContext(),\n      });\n    }\n  }\n\n  public logEvent(name: string, properties: any = {}) {\n    if (this.rudderstackClient && this._userId) {\n      this.rudderstackClient.track({\n        userId: this._userId,\n        event: name,\n        properties,\n        context: this.getContext(),\n      });\n    }\n  }\n\n  private getContext(): any {\n    const platform = PLATFORM_TO_ANALYTICS_PLATFORM[os.platform()] || os.platform();\n    const context = {\n      device: {\n        model: platform,\n        brand: platform,\n      },\n      os: {\n        name: platform,\n        version: os.release(),\n      },\n      app: {},\n    };\n\n    if (this._version) {\n      context.app = {\n        version: this._version,\n      };\n    }\n\n    return context;\n  }\n}\n\nconst defaultClient = new AnalyticsClient();\n\nexport default defaultClient;\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA0B;AAAA;AAAA;AAAA;AAE1B,MAAMA,8BAA8D,GAAG;EACrEC,MAAM,EAAE,KAAK;EACbC,KAAK,EAAE,SAAS;EAChBC,KAAK,EAAE;AACT,CAAC;AAEM,MAAMC,eAAe,CAAC;EAAA;IAAA;IAAA;IAAA;IAAA;EAAA;EAM3B,IAAWC,MAAM,GAAG;IAClB,OAAO,IAAI,CAACC,OAAO;EACrB;EAEA,IAAWC,OAAO,GAAG;IACnB,OAAO,IAAI,CAACC,QAAQ;EACtB;EAEA,MAAaC,KAAK,GAAG;IACnB,IAAI,IAAI,CAACC,iBAAiB,EAAE;MAC1B,MAAM,IAAI,CAACA,iBAAiB,CAACD,KAAK,EAAE;IACtC;EACF;EAEOE,gBAAgB,CACrBC,mBAA2B,EAC3BC,uBAA+B,EAC/BC,cAAsB,EACtB;IACA;IACA,IAAI,CAACJ,iBAAiB,GAAG,KAAIK,wBAAe,EAC1CH,mBAAmB,EACnB,KAAII,UAAG,EAAC,WAAW,EAAEH,uBAAuB,CAAC,CAACI,QAAQ,EAAE,EACxD;MACEC,aAAa,EAAE;IACjB,CAAC,CACF;IACD,IAAI,CAACV,QAAQ,GAAGM,cAAc;EAChC;EAEOK,YAAY,CAACd,MAAc,EAAEe,MAA8B,EAAE;IAClE,IAAI,CAACd,OAAO,GAAGD,MAAM;IACrB,IAAI,CAACgB,UAAU,GAAGD,MAAM;IAExB,IAAI,IAAI,CAACV,iBAAiB,EAAE;MAC1B,IAAI,CAACA,iBAAiB,CAACY,QAAQ,CAAC;QAC9BjB,MAAM,EAAE,IAAI,CAACC,OAAO;QACpBc,MAAM,EAAE,IAAI,CAACC,UAAU;QACvBE,OAAO,EAAE,IAAI,CAACC,UAAU;MAC1B,CAAC,CAAC;IACJ;EACF;EAEOC,QAAQ,CAACC,IAAY,EAAEC,UAAe,GAAG,CAAC,CAAC,EAAE;IAClD,IAAI,IAAI,CAACjB,iBAAiB,IAAI,IAAI,CAACJ,OAAO,EAAE;MAC1C,IAAI,CAACI,iBAAiB,CAACkB,KAAK,CAAC;QAC3BvB,MAAM,EAAE,IAAI,CAACC,OAAO;QACpBuB,KAAK,EAAEH,IAAI;QACXC,UAAU;QACVJ,OAAO,EAAE,IAAI,CAACC,UAAU;MAC1B,CAAC,CAAC;IACJ;EACF;EAEQA,UAAU,GAAQ;IACxB,MAAMM,QAAQ,GAAG9B,8BAA8B,CAAC+B,aAAE,CAACD,QAAQ,EAAE,CAAC,IAAIC,aAAE,CAACD,QAAQ,EAAE;IAC/E,MAAMP,OAAO,GAAG;MACdS,MAAM,EAAE;QACNC,KAAK,EAAEH,QAAQ;QACfI,KAAK,EAAEJ;MACT,CAAC;MACDC,EAAE,EAAE;QACFL,IAAI,EAAEI,QAAQ;QACdvB,OAAO,EAAEwB,aAAE,CAACI,OAAO;MACrB,CAAC;MACDC,GAAG,EAAE,CAAC;IACR,CAAC;IAED,IAAI,IAAI,CAAC5B,QAAQ,EAAE;MACjBe,OAAO,CAACa,GAAG,GAAG;QACZ7B,OAAO,EAAE,IAAI,CAACC;MAChB,CAAC;IACH;IAEA,OAAOe,OAAO;EAChB;AACF;AAAC;AAED,MAAMc,aAAa,GAAG,IAAIjC,eAAe,EAAE;AAAC,eAE7BiC,aAAa;AAAA"}