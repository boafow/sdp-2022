{"version":3,"file":"IosCodeSigning.js","names":["validateProvisioningProfile","plistData","distCertFingerprint","bundleIdentifier","_ensureDeveloperCertificateIsValid","_ensureBundleIdentifierIsValid","devCertBase64","DeveloperCertificates","devCertFingerprint","_genDerCertFingerprint","Error","certBase64","certBuffer","Buffer","from","crypto","createHash","update","digest","toUpperCase","expectedBundleIdentifier","actualApplicationIdentifier","Entitlements","actualBundleIdentifier","exec","minimatch"],"sources":["../../src/detach/IosCodeSigning.ts"],"sourcesContent":["import { PlistObject } from '@expo/plist';\nimport crypto from 'crypto';\nimport minimatch from 'minimatch';\n\nexport type IPABuilderParams = {\n  provisioningProfilePath: string;\n  certPath: string;\n  certPassword?: string;\n  appUUID: string;\n  keychainPath: string;\n  bundleIdentifier: string;\n  teamID: string;\n  manifest: any;\n  workspacePath: string;\n  clientBuild?: boolean;\n};\n\nexport function validateProvisioningProfile(\n  plistData: PlistObject,\n  {\n    distCertFingerprint,\n    bundleIdentifier,\n  }: { distCertFingerprint: string; bundleIdentifier: string }\n) {\n  _ensureDeveloperCertificateIsValid(plistData, distCertFingerprint);\n  _ensureBundleIdentifierIsValid(plistData, bundleIdentifier);\n}\n\nfunction _ensureDeveloperCertificateIsValid(plistData: any, distCertFingerprint: string) {\n  const devCertBase64 = plistData.DeveloperCertificates[0];\n  const devCertFingerprint = _genDerCertFingerprint(devCertBase64);\n  if (devCertFingerprint !== distCertFingerprint) {\n    throw new Error(\n      'validateProvisioningProfile: provisioning profile is not associated with uploaded distribution certificate'\n    );\n  }\n}\n\nfunction _genDerCertFingerprint(certBase64: string) {\n  const certBuffer = Buffer.from(certBase64, 'base64');\n  return crypto.createHash('sha1').update(certBuffer).digest('hex').toUpperCase();\n}\n\nfunction _ensureBundleIdentifierIsValid(plistData: any, expectedBundleIdentifier: string) {\n  const actualApplicationIdentifier = plistData.Entitlements['application-identifier'];\n  const actualBundleIdentifier = /\\.(.+)/.exec(actualApplicationIdentifier)?.[1];\n\n  if (!actualBundleIdentifier || !minimatch(expectedBundleIdentifier, actualBundleIdentifier)) {\n    throw new Error(\n      `validateProvisioningProfile: wrong bundleIdentifier found in provisioning profile; expected: ${expectedBundleIdentifier}, found (in provisioning profile): ${actualBundleIdentifier}`\n    );\n  }\n}\n"],"mappings":";;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAkC;AAe3B,SAASA,2BAA2B,CACzCC,SAAsB,EACtB;EACEC,mBAAmB;EACnBC;AACyD,CAAC,EAC5D;EACAC,kCAAkC,CAACH,SAAS,EAAEC,mBAAmB,CAAC;EAClEG,8BAA8B,CAACJ,SAAS,EAAEE,gBAAgB,CAAC;AAC7D;AAEA,SAASC,kCAAkC,CAACH,SAAc,EAAEC,mBAA2B,EAAE;EACvF,MAAMI,aAAa,GAAGL,SAAS,CAACM,qBAAqB,CAAC,CAAC,CAAC;EACxD,MAAMC,kBAAkB,GAAGC,sBAAsB,CAACH,aAAa,CAAC;EAChE,IAAIE,kBAAkB,KAAKN,mBAAmB,EAAE;IAC9C,MAAM,IAAIQ,KAAK,CACb,4GAA4G,CAC7G;EACH;AACF;AAEA,SAASD,sBAAsB,CAACE,UAAkB,EAAE;EAClD,MAAMC,UAAU,GAAGC,MAAM,CAACC,IAAI,CAACH,UAAU,EAAE,QAAQ,CAAC;EACpD,OAAOI,iBAAM,CAACC,UAAU,CAAC,MAAM,CAAC,CAACC,MAAM,CAACL,UAAU,CAAC,CAACM,MAAM,CAAC,KAAK,CAAC,CAACC,WAAW,EAAE;AACjF;AAEA,SAASd,8BAA8B,CAACJ,SAAc,EAAEmB,wBAAgC,EAAE;EAAA;EACxF,MAAMC,2BAA2B,GAAGpB,SAAS,CAACqB,YAAY,CAAC,wBAAwB,CAAC;EACpF,MAAMC,sBAAsB,YAAG,QAAQ,CAACC,IAAI,CAACH,2BAA2B,CAAC,0CAA1C,MAA6C,CAAC,CAAC;EAE9E,IAAI,CAACE,sBAAsB,IAAI,CAAC,IAAAE,oBAAS,EAACL,wBAAwB,EAAEG,sBAAsB,CAAC,EAAE;IAC3F,MAAM,IAAIb,KAAK,CACZ,gGAA+FU,wBAAyB,sCAAqCG,sBAAuB,EAAC,CACvL;EACH;AACF"}