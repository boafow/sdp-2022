{"version":3,"file":"StandaloneContext.js","names":["isStandaloneContextDataUser","value","projectPath","isStandaloneContextTestEnvironment","includes","isStandaloneContextDataService","testEnvironment","expoSourcePath","shellAppSdkVersion","StandaloneContext","isAnonymous","exp","publishedUrl","context","StandaloneContextUser","url","releaseChannel","StandaloneBuildFlags","createEmpty","config","archivePath","manifest","privateConfig","build","StandaloneContextService","constructor","data","published"],"sources":["../../src/detach/StandaloneContext.ts"],"sourcesContent":["import { StandaloneBuildFlags } from '../internal';\n\ntype StandaloneContextDataType = 'user' | 'service';\n\ntype StandaloneContextTestEnvironment = 'none' | 'local' | 'ci';\n\n// currently unused\nexport function isStandaloneContextDataUser(value: any): value is StandaloneContextDataUser {\n  return value && typeof value.projectPath === 'string' && 'exp' in value;\n}\n\nexport function isStandaloneContextTestEnvironment(\n  value: string\n): value is StandaloneContextTestEnvironment {\n  return ['none', 'local', 'ci'].includes(value);\n}\n\nexport function isStandaloneContextDataService(value: any): value is StandaloneContextDataService {\n  return (\n    value &&\n    isStandaloneContextTestEnvironment(value.testEnvironment) &&\n    typeof value.expoSourcePath === 'string' &&\n    typeof value.shellAppSdkVersion === 'string'\n  );\n}\n\n/**\n *  A user context is used when we are configuring a standalone app locally on a user's machine,\n *  such as during `exp detach`.\n */\nexport type StandaloneContextDataUser = {\n  projectPath: string;\n  exp: any;\n};\n\n/**\n *  A service context is used when we are generating a standalone app remotely on an Expo\n *  service machine, such as during `exp build`.\n */\nexport type StandaloneContextDataService = {\n  expoSourcePath: string;\n  archivePath: string | null;\n  manifest: any;\n  privateConfig: any;\n  testEnvironment: StandaloneContextTestEnvironment;\n  shellAppSdkVersion: string;\n};\n\nclass StandaloneContext {\n  data?: StandaloneContextDataUser | StandaloneContextDataService;\n  config: any; // same as underlying app.json or manifest\n\n  static createUserContext = (\n    projectPath: string,\n    exp: any,\n    publishedUrl?: string\n  ): StandaloneContextUser => {\n    const context = new StandaloneContextUser(\n      {\n        projectPath,\n        exp,\n      },\n      {\n        url: publishedUrl,\n        releaseChannel: 'default',\n      },\n      // we never expect to handle the build step for user contexts right now\n      StandaloneBuildFlags.createEmpty()\n    );\n    context.config = exp;\n    return context;\n  };\n\n  static createServiceContext = (\n    expoSourcePath: string,\n    archivePath: string | null,\n    manifest: any,\n    privateConfig: any,\n    testEnvironment: StandaloneContextTestEnvironment,\n    build: StandaloneBuildFlags,\n    publishedUrl: string,\n    releaseChannel: string,\n    shellAppSdkVersion: string\n  ): StandaloneContextService => {\n    const context = new StandaloneContextService(\n      {\n        expoSourcePath,\n        archivePath,\n        manifest,\n        privateConfig,\n        testEnvironment,\n        shellAppSdkVersion,\n      },\n      {\n        url: publishedUrl,\n        releaseChannel: releaseChannel ? releaseChannel : 'default',\n      },\n      build\n    );\n    context.config = manifest;\n\n    return context;\n  };\n\n  /**\n   *  On iOS we begin configuring standalone apps before we have any information about the\n   *  project's manifest. By default let's treat all contexts as non-anonymous and override\n   *  it in contexts that needs this to be different.\n   */\n  isAnonymous() {\n    return false;\n  }\n}\n\nexport class StandaloneContextUser extends StandaloneContext {\n  type: StandaloneContextDataType = 'user';\n  constructor(\n    public data: StandaloneContextDataUser,\n    public published: {\n      url?: string;\n      releaseChannel: 'default';\n    },\n    public build: StandaloneBuildFlags\n  ) {\n    super();\n  }\n}\n\nexport class StandaloneContextService extends StandaloneContext {\n  type: StandaloneContextDataType = 'service';\n  constructor(\n    public data: StandaloneContextDataService,\n    public published: {\n      url: string;\n      releaseChannel: string;\n    },\n    public build: StandaloneBuildFlags\n  ) {\n    super();\n  }\n\n  /**\n   *  On iOS we begin configuring standalone apps before we have any information about the\n   *  project's manifest.\n   */\n  isAnonymous() {\n    return true;\n  }\n}\n\nexport type AnyStandaloneContext = StandaloneContextUser | StandaloneContextService;\n\nexport default StandaloneContext;\n"],"mappings":";;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAmD;AAAA;AAAA;AAMnD;AACO,SAASA,2BAA2B,CAACC,KAAU,EAAsC;EAC1F,OAAOA,KAAK,IAAI,OAAOA,KAAK,CAACC,WAAW,KAAK,QAAQ,IAAI,KAAK,IAAID,KAAK;AACzE;AAEO,SAASE,kCAAkC,CAChDF,KAAa,EAC8B;EAC3C,OAAO,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC,CAACG,QAAQ,CAACH,KAAK,CAAC;AAChD;AAEO,SAASI,8BAA8B,CAACJ,KAAU,EAAyC;EAChG,OACEA,KAAK,IACLE,kCAAkC,CAACF,KAAK,CAACK,eAAe,CAAC,IACzD,OAAOL,KAAK,CAACM,cAAc,KAAK,QAAQ,IACxC,OAAON,KAAK,CAACO,kBAAkB,KAAK,QAAQ;AAEhD;;AAEA;AACA;AACA;AACA;;AAmBA,MAAMC,iBAAiB,CAAC;EAAA;IAAA;IAAA;EAAA;EAwDtB;AACF;AACA;AACA;AACA;EACEC,WAAW,GAAG;IACZ,OAAO,KAAK;EACd;AACF;AAAC,gBAhEKD,iBAAiB,uBAIM,CACzBP,WAAmB,EACnBS,GAAQ,EACRC,YAAqB,KACK;EAC1B,MAAMC,OAAO,GAAG,IAAIC,qBAAqB,CACvC;IACEZ,WAAW;IACXS;EACF,CAAC,EACD;IACEI,GAAG,EAAEH,YAAY;IACjBI,cAAc,EAAE;EAClB,CAAC;EACD;EACAC,gCAAoB,CAACC,WAAW,EAAE,CACnC;EACDL,OAAO,CAACM,MAAM,GAAGR,GAAG;EACpB,OAAOE,OAAO;AAChB,CAAC;AAAA,gBAvBGJ,iBAAiB,0BAyBS,CAC5BF,cAAsB,EACtBa,WAA0B,EAC1BC,QAAa,EACbC,aAAkB,EAClBhB,eAAiD,EACjDiB,KAA2B,EAC3BX,YAAoB,EACpBI,cAAsB,EACtBR,kBAA0B,KACG;EAC7B,MAAMK,OAAO,GAAG,IAAIW,wBAAwB,CAC1C;IACEjB,cAAc;IACda,WAAW;IACXC,QAAQ;IACRC,aAAa;IACbhB,eAAe;IACfE;EACF,CAAC,EACD;IACEO,GAAG,EAAEH,YAAY;IACjBI,cAAc,EAAEA,cAAc,GAAGA,cAAc,GAAG;EACpD,CAAC,EACDO,KAAK,CACN;EACDV,OAAO,CAACM,MAAM,GAAGE,QAAQ;EAEzB,OAAOR,OAAO;AAChB,CAAC;AAYI,MAAMC,qBAAqB,SAASL,iBAAiB,CAAC;EAE3DgB,WAAW,CACFC,IAA+B,EAC/BC,SAGN,EACMJ,KAA2B,EAClC;IACA,KAAK,EAAE;IAAC,KAPDG,IAA+B,GAA/BA,IAA+B;IAAA,KAC/BC,SAGN,GAHMA,SAGN;IAAA,KACMJ,KAA2B,GAA3BA,KAA2B;IAAA,8BAPF,MAAM;EAUxC;AACF;AAAC;AAEM,MAAMC,wBAAwB,SAASf,iBAAiB,CAAC;EAE9DgB,WAAW,CACFC,IAAkC,EAClCC,SAGN,EACMJ,KAA2B,EAClC;IACA,KAAK,EAAE;IAAC,KAPDG,IAAkC,GAAlCA,IAAkC;IAAA,KAClCC,SAGN,GAHMA,SAGN;IAAA,KACMJ,KAA2B,GAA3BA,KAA2B;IAAA,8BAPF,SAAS;EAU3C;;EAEA;AACF;AACA;AACA;EACEb,WAAW,GAAG;IACZ,OAAO,IAAI;EACb;AACF;AAAC;AAAA,eAIcD,iBAAiB;AAAA"}