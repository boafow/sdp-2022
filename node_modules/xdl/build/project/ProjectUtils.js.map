{"version":3,"file":"ProjectUtils.js","names":["MAX_MESSAGE_LENGTH","_projectRootToLogger","_getLogger","projectRoot","logger","Logger","child","type","project","path","resolve","getLogger","logWithLevel","level","fields","msg","id","issueId","debug","info","warn","error","logDebug","tag","message","toString","logInfo","logError","truncatedMessage","length","substring","logWarning","Analytics","logEvent","clearNotification","issueCleared","attachLoggerStream","stream","addStream"],"sources":["../../src/project/ProjectUtils.ts"],"sourcesContent":["import path from 'path';\n\nimport { Analytics, Log, Logger, LogStream } from '../internal';\n\nconst MAX_MESSAGE_LENGTH = 200;\nconst _projectRootToLogger: { [projectRoot: string]: Log } = {};\n\nfunction _getLogger(projectRoot: string): Log {\n  let logger = _projectRootToLogger[projectRoot];\n  if (!logger) {\n    logger = Logger.child({\n      type: 'project',\n      project: path.resolve(projectRoot),\n    });\n    _projectRootToLogger[projectRoot] = logger;\n  }\n\n  return logger;\n}\n\nexport type LogTag = 'expo' | 'metro' | 'device';\nexport type LogFields = {\n  tag: LogTag;\n  issueId?: string;\n  issueCleared?: boolean;\n  includesStack?: boolean;\n  deviceId?: string;\n  deviceName?: string;\n  groupDepth?: number;\n  shouldHide?: boolean;\n  _expoEventType?: 'TUNNEL_READY';\n};\n\nexport function getLogger(projectRoot: string): Log {\n  return _getLogger(projectRoot);\n}\n\nexport function logWithLevel(\n  projectRoot: string,\n  level: string,\n  fields: LogFields,\n  msg: string,\n  id?: string\n) {\n  if (id) {\n    fields.issueId = id;\n  }\n\n  const logger = _getLogger(projectRoot);\n  switch (level) {\n    case 'debug':\n      logger.debug(fields, msg);\n      break;\n    case 'info':\n      logger.info(fields, msg);\n      break;\n    case 'warn':\n      logger.warn(fields, msg);\n      break;\n    case 'error':\n      logger.error(fields, msg);\n      break;\n    default:\n      logger.debug(fields, msg);\n      break;\n  }\n}\n\nexport function logDebug(projectRoot: string, tag: LogTag, message: string, id?: string) {\n  _getLogger(projectRoot).debug({ tag }, message.toString());\n}\n\nexport function logInfo(projectRoot: string, tag: LogTag, message: string, id?: string) {\n  const fields: LogFields = { tag };\n  if (id) {\n    fields.issueId = id;\n  }\n  _getLogger(projectRoot).info(fields, message.toString());\n}\n\nexport function logError(projectRoot: string, tag: LogTag, message: string, id?: string) {\n  const fields: LogFields = { tag };\n  if (id) {\n    fields.issueId = id;\n  }\n  _getLogger(projectRoot).error(fields, message.toString());\n\n  let truncatedMessage = message.toString();\n  if (truncatedMessage.length > MAX_MESSAGE_LENGTH) {\n    truncatedMessage = truncatedMessage.substring(0, MAX_MESSAGE_LENGTH);\n  }\n}\n\nexport function logWarning(projectRoot: string, tag: LogTag, message: string, id?: string) {\n  const fields: LogFields = { tag };\n  if (id) {\n    fields.issueId = id;\n  }\n  _getLogger(projectRoot).warn(fields, message.toString());\n\n  let truncatedMessage = message.toString();\n  if (truncatedMessage.length > MAX_MESSAGE_LENGTH) {\n    truncatedMessage = truncatedMessage.substring(0, MAX_MESSAGE_LENGTH);\n  }\n  Analytics.logEvent('Project Warning', {\n    tag,\n    message: truncatedMessage,\n  });\n}\n\nexport function clearNotification(projectRoot: string, id: string) {\n  _getLogger(projectRoot).info(\n    {\n      tag: 'expo',\n      issueCleared: true,\n      issueId: id,\n    },\n    `No issue with ${id}`\n  );\n}\n\nexport function attachLoggerStream(projectRoot: string, stream: LogStream) {\n  _getLogger(projectRoot).addStream(stream);\n}\n"],"mappings":"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"}