{"version":3,"file":"ModuleVersion.js","names":["createModuleVersionChecker","name","currentVersion","UpdateCacher","FsCache","Cacher","pkgJson","pTimeout","npmPackageJson","version","latestVersion","latestVersionAsync","deprecated","checkAsync","getAsync","updateIsAvailable","semver","gt","latest","current"],"sources":["../../src/tools/ModuleVersion.ts"],"sourcesContent":["import latestVersionAsync from 'latest-version';\nimport pTimeout from 'p-timeout';\nimport npmPackageJson from 'package-json';\nimport semver from 'semver';\n\nimport { FsCache } from '../internal';\n\n/** @deprecated just use the update-check npm package */\nfunction createModuleVersionChecker(name: string, currentVersion: string) {\n  const UpdateCacher = new FsCache.Cacher(\n    async () => {\n      const pkgJson = await pTimeout(npmPackageJson(name, { version: currentVersion }), 2000);\n      return {\n        latestVersion: await pTimeout(latestVersionAsync(name), 2000),\n        deprecated: pkgJson.deprecated,\n      };\n    },\n    `${name}-${currentVersion}-updates.json`,\n    24 * 60 * 60 * 1000 // one day\n  );\n\n  async function checkAsync() {\n    const { latestVersion, deprecated } = await UpdateCacher.getAsync();\n    return {\n      updateIsAvailable: semver.gt(latestVersion, currentVersion),\n      latest: latestVersion,\n      current: currentVersion,\n      deprecated,\n    };\n  }\n\n  return { checkAsync };\n}\n\nexport { createModuleVersionChecker };\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAsC;AAEtC;AACA,SAASA,0BAA0B,CAACC,IAAY,EAAEC,cAAsB,EAAE;EACxE,MAAMC,YAAY,GAAG,KAAIC,mBAAO,CAACC,MAAM,EACrC,YAAY;IACV,MAAMC,OAAO,GAAG,MAAM,IAAAC,mBAAQ,EAAC,IAAAC,sBAAc,EAACP,IAAI,EAAE;MAAEQ,OAAO,EAAEP;IAAe,CAAC,CAAC,EAAE,IAAI,CAAC;IACvF,OAAO;MACLQ,aAAa,EAAE,MAAM,IAAAH,mBAAQ,EAAC,IAAAI,wBAAkB,EAACV,IAAI,CAAC,EAAE,IAAI,CAAC;MAC7DW,UAAU,EAAEN,OAAO,CAACM;IACtB,CAAC;EACH,CAAC,EACA,GAAEX,IAAK,IAAGC,cAAe,eAAc,EACxC,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;EAAA,CACrB;;EAED,eAAeW,UAAU,GAAG;IAC1B,MAAM;MAAEH,aAAa;MAAEE;IAAW,CAAC,GAAG,MAAMT,YAAY,CAACW,QAAQ,EAAE;IACnE,OAAO;MACLC,iBAAiB,EAAEC,iBAAM,CAACC,EAAE,CAACP,aAAa,EAAER,cAAc,CAAC;MAC3DgB,MAAM,EAAER,aAAa;MACrBS,OAAO,EAAEjB,cAAc;MACvBU;IACF,CAAC;EACH;EAEA,OAAO;IAAEC;EAAW,CAAC;AACvB"}